
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EduPro Academy - Professional Learning Platform</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
    }

    .fade-in {
      animation: fadeIn 0.8s ease-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(30px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .slide-in {
      animation: slideIn 0.6s ease-out;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-30px);
      }

      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .hero-gradient {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
    }

    .card-hover {
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .card-hover:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    }

    .progress-bar {
      transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .locked {
      opacity: 0.5;
      pointer-events: none;
    }

    .certificate-bg {
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #667eea 100%);
      border: 12px solid #ffd700;
      box-shadow: 0 0 40px rgba(0, 0, 0, 0.4);
    }

    .nav-glass {
      backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.95);
    }

    .stats-counter {
      animation: countUp 2s ease-out;
    }

    @keyframes countUp {
      from {
        opacity: 0;
        transform: scale(0.5);
      }

      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .floating {
      animation: floating 3s ease-in-out infinite;
    }

    @keyframes floating {

      0%,
      100% {
        transform: translateY(0px);
      }

      50% {
        transform: translateY(-10px);
      }
    }

    .pulse-glow {
      animation: pulseGlow 2s infinite;
    }

    @keyframes pulseGlow {

      0%,
      100% {
        box-shadow: 0 0 20px rgba(102, 126, 234, 0.4);
      }

      50% {
        box-shadow: 0 0 30px rgba(102, 126, 234, 0.8);
      }
    }

    .language-filter.active {
      background-color: #4f46e5;
      color: white;
    }

    .language-filter {
      color: #6b7280;
    }

    /* Modal Styles */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.6);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      transition: opacity 0.3s ease;
    }

    .modal-content {
      background-color: white;
      border-radius: 1rem;
      padding: 2rem;
      max-width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
      transform: scale(1);
      transition: transform 0.3s ease;
    }

    /* ENHANCED ADMIN PROFILE CARD STYLING */
    .admin-profile-card {
      border-radius: 1.5rem;
      background: #ffffff;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }

    .detail-row {
      padding: 0.5rem 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #f3f4f6;
    }

    .course-item-admin {
      transition: all 0.2s;
    }

    .course-item-admin:hover {
      background-color: #eef2ff;
    }

    /* ************************************************* */
    /* ******* NEW: ATTRACTIVE CONTENT STYLES ******* */
    /* ************************************************* */

    /* Basic cleanup for rendered HTML */
    .content-container {
      font-family: inherit;
    }

    .content-container h4 {
      font-size: 1.5rem;
      font-weight: 700;
      color: #4f46e5;
      /* Indigo 600 */
      margin-top: 1.5rem;
      margin-bottom: 0.75rem;
      padding-bottom: 0.25rem;
      border-bottom: 2px solid #eef2ff;
      animation: slideIn 0.5s ease-out;
    }

    .content-container h5 {
      font-size: 1.25rem;
      font-weight: 600;
      color: #1f2937;
      /* Gray 800 */
      margin-top: 1rem;
      margin-bottom: 0.5rem;
      border-left: 4px solid #a78bfa;
      /* Purple 400 */
      padding-left: 0.75rem;
    }

    .content-container p {
      font-size: 1rem;
      line-height: 1.75;
      color: #4b5563;
      /* Gray 600 */
      margin-bottom: 1rem;
    }

    .content-container ul,
    .content-container ol {
      margin-left: 1.5rem;
      margin-bottom: 1rem;
      padding-left: 0.5rem;
      list-style: disc;
    }

    .content-container ol {
      list-style: decimal;
    }

    .content-container ul li,
    .content-container ol li {
      margin-bottom: 0.5rem;
      color: #374151;
      /* Gray 700 */
      line-height: 1.5;
    }

    /* Use Tailwind Classes for Rich Text inside contenteditable */
    .content-container strong,
    .content-container b {
      color: #ef4444;
      /* Red 500 */
      font-weight: 800;
      padding: 2px 4px;
      background-color: #fee2e2;
      /* Red 100 */
      border-radius: 4px;
    }

    .content-container em,
    .content-container i {
      font-style: italic;
      color: #2563eb;
      /* Blue 600 */
    }

    .content-container u {
      text-decoration: underline;
      text-decoration-color: #f59e0b;
      /* Amber 500 */
    }

    .content-container code,
    .content-container pre {
      background-color: #1f2937;
      /* Dark background for code */
      color: #e5e7eb;
      /* Light text */
      padding: 1rem;
      border-radius: 0.5rem;
      overflow-x: auto;
      font-family: 'Consolas', 'Monaco', monospace;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      border-left: 5px solid #6366f1;
      /* Indigo border */
      animation: fade-in 0.6s ease-out;
    }

    .content-container blockquote {
      border-left: 5px solid #f97316;
      /* Orange border for quotes */
      background-color: #fff7ed;
      /* Light orange background */
      padding: 1rem 1.5rem;
      margin: 1rem 0;
      color: #9a3412;
      /* Darker orange text */
      font-style: italic;
      border-radius: 0.5rem;
    }

    /* Admin Content Editor Styling */
    .content-editor {
      border: 1px solid #ccc;
      min-height: 100px;
      padding: 10px;
      outline: none;
      cursor: text;
    }

    .block-type-selector {
      width: 120px;
    }
  </style>

  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Reenie+Beanie&display=swap" rel="stylesheet">


<!-- PREMIUM UI & UX ENHANCEMENTS: Glassmorphism, Animations, Shimmer, Dark Mode -->
<style>
  /* Glassmorphism cards */
  .glass-card {
    background: rgba(255,255,255,0.55);
    backdrop-filter: blur(8px) saturate(120%);
    -webkit-backdrop-filter: blur(8px) saturate(120%);
    border: 1px solid rgba(255,255,255,0.6);
    box-shadow: 0 8px 32px rgba(31, 38, 135, 0.08);
    border-radius: 1rem;
  }
  /* Animated course tiles */
  .course-tile {
    transition: transform .35s cubic-bezier(.2,.9,.2,1), box-shadow .35s;
    will-change: transform;
  }
  .course-tile:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: 0 20px 40px rgba(16,24,40,0.12);
  }
  .tag-badge {
    display:inline-block;
    padding:4px 8px;
    font-size:12px;
    border-radius:999px;
    font-weight:700;
    background: linear-gradient(90deg,#f59e0b,#ef4444);
    color:white;
  }

  /* Dark mode base overrides */
  :root { --bg:#f8fafc; --card-bg: rgba(255,255,255,0.9); --text:#0f172a; }
  [data-theme="dark"] { --bg:#0b1220; --card-bg: rgba(255,255,255,0.03); --text:#e6eef8; }
  body { background: var(--bg); color:var(--text); transition: background .3s, color .3s; }

  .glass-card { background: var(--card-bg); }

  /* Dynamic gradient header */
  .dynamic-gradient {
    background: linear-gradient(270deg,#667eea,#764ba2,#f093fb);
    background-size: 600% 600%;
    animation: gradientShift 12s ease infinite;
  }
  @keyframes gradientShift {
    0%{background-position:0% 50%}
    50%{background-position:100% 50%}
    100%{background-position:0% 50%}
  }

  /* Shimmer placeholder */
  .shimmer {
    position:relative;
    overflow:hidden;
    background:linear-gradient(#e6e9ee, #f3f4f6);
  }
  .shimmer::after{
    content:"";
    position:absolute;
    inset:0;
    transform:translateX(-100%);
    background:linear-gradient(90deg, rgba(255,255,255,0), rgba(255,255,255,0.7), rgba(255,255,255,0));
    animation: shimmerMove 1.2s infinite;
  }
  @keyframes shimmerMove { to { transform:translateX(100%);} }

  /* Floating Resume Modal */
  .resume-modal {
    position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
    background:rgba(2,6,23,0.5); z-index:9999;
  }
  .resume-modal .modal-inner {
    width:100%; max-width:480px; padding:20px; border-radius:12px;
  }

  /* Floating complete button */
  #mark-complete-btn {
    position:fixed; right:20px; bottom:100px; z-index:1200;
    background:linear-gradient(90deg,#10b981,#06b6d4); color:white; padding:12px 16px; border-radius:12px;
    box-shadow:0 10px 30px rgba(2,6,23,0.18); cursor:pointer; display:none;
  }

  /* Search input style */
  #premium-search {
    width:100%; max-width:560px; padding:10px 12px; border-radius:999px; border:1px solid rgba(15,23,42,0.08);
    box-shadow:0 6px 16px rgba(2,6,23,0.04);
  }

  /* Widget drag handle */
  .widget { cursor:move; }
  .widget-placeholder { border:2px dashed rgba(79,70,229,0.25); padding:20px; border-radius:12px; }

  /* Leaderboard */
  .leaderboard { max-width:420px; margin:12px auto; }
  .leaderboard .item { display:flex; align-items:center; gap:12px; padding:10px; border-radius:10px; }
  .leaderboard .avatar { width:44px; height:44px; border-radius:999px; display:flex; align-items:center; justify-content:center; background:#eef2ff; font-weight:700; }

  /* small responsive tweaks */
  @media (max-width:640px) {
    #mark-complete-btn { right:12px; bottom:80px; }
  }
</style>

</head>

\1

  <!-- START: Global Loader (shows during Login/Register actions) -->
  <style>
    /* Loader overlay */
    #global-loader {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      backdrop-filter: blur(3px);
    }
    .loader-box {
      background: white;
      padding: 24px 28px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      gap: 16px;
      box-shadow: 0 10px 30px rgba(2,6,23,0.35);
      min-width: 260px;
    }
    .lds-ring { display: inline-block; position: relative; width: 48px; height: 48px; }
    .lds-ring div { box-sizing: border-box; display: block; position: absolute; width: 40px; height: 40px; margin: 4px; border: 4px solid #4f46e5; border-radius: 50%; animation: lds-ring 1.2s cubic-bezier(0.5,0,0.5,1) infinite; border-color: #4f46e5 transparent transparent transparent; }
    .lds-ring div:nth-child(1) { animation-delay: -0.45s; }
    .lds-ring div:nth-child(2) { animation-delay: -0.3s; }
    .lds-ring div:nth-child(3) { animation-delay: -0.15s; }
    @keyframes lds-ring { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    #global-loader p { margin:0; font-weight:600; color:#0f172a; }
  </style>

  <div id="global-loader" aria-hidden="true">
    <div class="loader-box">
      <div class="lds-ring" aria-hidden="true"><div></div><div></div><div></div><div></div></div>
      <div>
        <p>Processing — please wait</p>
        <p style="font-size:12px;color:#6b7280;margin-top:4px">Logging in or registering your account securely...</p>
      </div>
    </div>
  </div>
  <!-- END: Global Loader -->

  <nav class="nav-glass shadow-xl fixed w-full top-0 z-50">
    <div class="max-w-7xl mx-auto px-6">
      <div class="flex justify-between items-center py-4">
        <div class="flex items-center space-x-3">
          <div
            class="w-10 h-10 bg-gradient-to-r from-indigo-600 to-purple-600 rounded-lg flex items-center justify-center">
            <span class="text-white font-bold text-lg">E</span>
          </div>
          <h1 class="text-2xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
            EduPro Academy</h1>
        </div>

        <div id="nav-buttons" class="flex items-center space-x-4">
          <button onclick="showAdminLogin()"
            class="bg-yellow-500 text-gray-900 px-4 py-2.5 rounded-full hover:shadow-lg transition-all duration-300 font-medium">Admin</button>
          <button onclick="showLogin()"
            class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-6 py-2.5 rounded-full hover:shadow-lg transition-all duration-300 font-medium">Sign
            In</button>
          <button onclick="showRegister()"
            class="bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-2.5 rounded-full hover:shadow-lg transition-all duration-300 font-medium">Get
            Started</button>
        </div>

        <button id="mobile-menu-btn" class="md:hidden p-2 rounded-lg bg-white bg-opacity-10 border border-white/20">
          <svg id="mobile-menu-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
        </button>

        <!-- Slide-in mobile menu (right to left) -->
        <div id="mobile-slide-menu" class="fixed top-0 right-0 h-full w-80 bg-white shadow-2xl transform translate-x-full transition-transform z-50 md:hidden">
          <div class="p-6 flex items-center justify-between border-b">
            <div class="flex items-center space-x-3">
              <div class="w-10 h-10 bg-gradient-to-r from-indigo-600 to-purple-600 rounded-lg flex items-center justify-center">
                <span class="text-white font-bold text-lg">E</span>
              </div>
              <div class="font-bold text-lg">EduPro</div>
            </div>
            <button id="mobile-close-btn" class="p-2 rounded-md bg-gray-100">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-800" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
              </svg>
            </button>
          </div>
          <nav class="p-6 space-y-4">
            <a href="#" onclick="showWelcomeScreen(); closeMobileMenu();" class="block font-semibold text-gray-800">Home</a>
            <a href="#" onclick="showCourseList(); closeMobileMenu();" class="block font-semibold text-gray-800">Courses</a>
            <a href="#" onclick="showLogin(); closeMobileMenu();" class="block font-semibold text-gray-800">Sign In</a>
            <a href="#" onclick="showRegister(); closeMobileMenu();" class="block font-semibold text-gray-800">Get Started</a>
            <a href="#" onclick="showContact(); closeMobileMenu();" class="block font-semibold text-gray-800">Contact</a>
          </nav>
        </div>

        <div id="user-nav" class="hidden flex items-center space-x-2">
          <div class="flex items-center space-x-1 bg-white rounded-full px-4 py-2 shadow-md">
            <div
              class="w-8 h-8 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-full flex items-center justify-center">
              <span class="text-white text-sm font-semibold" id="user-avatar"></span>
            </div>
            <span class="text-gray-700 font-medium" id="user-name-nav"></span>
          </div>
          <button onclick="showDashboard()"
            class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors">Dashboard</button>
          <button onclick="showProfile()"
            class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors">My
            Courses</button>
          <button onclick="showCertificates()"
            class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">Certificates</button>
          <button onclick="showMyAccount()"
            class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">My
            Account</button>
          <button onclick="logout()"
            class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors">Logout</button>
        </div>

        <div id="admin-nav" class="hidden items-center space-x-2">
          <span class="text-sm font-bold text-red-600">Admin Mode</span>
          <button onclick="showAdminDashboard()"
            class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">Dashboard</button>
          <button onclick="showCourseManagerPanel()"
            class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors">Courses</button>
          <button onclick="adminLogout()"
            class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors">Logout</button>
        </div>
      </div>
    </div>
  </nav>

  <div class="pt-20">
    <div id="welcome-screen" class="fade-in">
      <section class="hero-gradient text-white py-20 px-4 sm:px-6">
        <div class="max-w-7xl mx-auto text-center">
          <div class="floating mb-8">
            <div class="inline-block p-4 bg-white bg-opacity-20 rounded-full">
              <svg class="w-16 h-16" fill="currentColor" viewBox="0 0 20 20">
                <path
                  d="M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.838L7.667 9.088l1.94.831a1 1 0 00.787 0l7-3a1 1 0 000-1.838l-7-3zM3.31 9.397L5 10.12v4.102a8.969 8.969 0 00-1.05-.174 1 1 0 01-.89-.89 11.115 11.115 0 01.25-3.762zM9.3 16.573A9.026 9.026 0 007 14.935v-3.957l1.818.78a3 3 0 002.364 0l5.508-2.361a11.026 11.026 0 01.25 3.762 1 1 0 01-.89.89 8.968 8.968 0 00-5.35 2.524 1 1 0 01-1.4 0zM6 18a1 1 0 001-1v-2.065a8.935 8.935 0 00-2-.712V17a1 1 0 001 1z" />
              </svg>
            </div>
          </div>
          <h1 class="text-5xl md:text-7xl font-bold mb-6 slide-in">
            Transform Your
            <span class="bg-gradient-to-r from-yellow-300 to-orange-300 bg-clip-text text-transparent">Career</span>
          </h1>
          <p class="text-xl md:text-2xl mb-8 text-white text-opacity-90 max-w-3xl mx-auto slide-in">
            Join thousands of professionals mastering cutting-edge skills with our expert-designed courses.
            Learn at your own pace, earn certificates, and advance your career.
          </p>
          <div class="flex flex-col sm:flex-row gap-4 justify-center mb-12 slide-in">
            <button onclick="showRegister()"
              class="pulse-glow bg-white text-indigo-600 px-8 py-4 rounded-full text-lg font-semibold hover:bg-gray-100 transition-all duration-300">
              Start Learning Today
            </button>
            <button onclick="showCourseList()"
              class="border-2 border-white text-white px-8 py-4 rounded-full text-lg font-semibold hover:bg-white hover:text-indigo-600 transition-all duration-300">
              Explore Courses
            </button>
          </div>
        </div>
      </section>

      <section class="py-16 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6">
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-8 text-center">
            <div class="stats-counter">
              <div class="text-4xl font-bold text-indigo-600 mb-2">15+</div>
              <div class="text-gray-600 font-medium">Expert Courses</div>
            </div>
            <div class="stats-counter">
              <div class="text-4xl font-bold text-purple-600 mb-2">5K+</div>
              <div class="text-gray-600 font-medium">Students</div>
            </div>
            <div class="stats-counter">
              <div class="text-4xl font-bold text-green-600 mb-2">98%</div>
              <div class="text-gray-600 font-medium">Success Rate</div>
            </div>
            <div class="stats-counter">
              <div class="text-4xl font-bold text-orange-600 mb-2">24/7</div>
              <div class="text-gray-600 font-medium">Support</div>
            </div>
          </div>
        </div>
      </section>

      <section class="py-20 bg-gray-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6">
          <div class="text-center mb-16">
            <h2 class="text-4xl font-bold text-gray-800 mb-4">Why Choose EduPro Academy?</h2>
            <p class="text-xl text-gray-600 max-w-2xl mx-auto">Experience the future of online learning with
              our innovative platform</p>
          </div>

          <div class="grid md:grid-cols-3 gap-4 md:gap-8">
            <div class="card-hover bg-white p-8 rounded-2xl shadow-lg text-center">
              <div
                class="w-16 h-16 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-full flex items-center justify-center mx-auto mb-6">
                <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
              </div>
              <h3 class="text-2xl font-semibold mb-4">Industry-Recognized Certificates</h3>
              <p class="text-gray-600">Earn certificates that employers value and trust</p>
            </div>

            <div class="card-hover bg-white p-8 rounded-2xl shadow-lg text-center">
              <div
                class="w-16 h-16 bg-gradient-to-r from-green-500 to-emerald-500 rounded-full flex items-center justify-center mx-auto mb-6">
                <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z" />
                </svg>
              </div>
              <h3 class="text-2xl font-semibold mb-4">Expert Instructors</h3>
              <p class="text-gray-600">Learn from industry professionals with real-world experience</p>
            </div>

            <div class="card-hover bg-white p-8 rounded-2xl shadow-lg text-center">
              <div
                class="w-16 h-16 bg-gradient-to-r from-orange-500 to-red-500 rounded-full flex items-center justify-center mx-auto mb-6">
                <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
                  <path
                    d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z" />
                </svg>
              </div>
              <h3 class="text-2xl font-semibold mb-4">Progress Tracking</h3>
              <p class="text-gray-600">Monitor your learning journey with detailed analytics</p>
            </div>
          </div>
        </div>
      </section>

      <section class="py-20 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6">
          <div class="text-center mb-16">
            <h2 class="text-4xl font-bold text-gray-800 mb-4">Popular Courses</h2>
            <p class="text-xl text-gray-600">Start your learning journey with our most popular courses</p>
          </div>

          <div class="grid md:grid-cols-3 gap-4 md:gap-8" id="popular-courses-preview">
          </div>

          <div class="text-center mt-12">
            <button onclick="showCourseList()"
              class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-8 py-4 rounded-full text-lg font-semibold hover:shadow-lg transition-all duration-300">
              View All Courses
            </button>
          </div>
        </div>
      </section>

    <!-- START: Student Achievements Slider -->
    <section id="achievements-slider" class="py-12 bg-gradient-to-b from-white to-gray-50">
      <div class="max-w-7xl mx-auto px-4 sm:px-6">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-3xl font-bold text-gray-800">Student Achievements</h2>
          <div class="flex gap-2 items-center">
            <button id="slide-prev" class="px-3 py-2 rounded-lg bg-gray-100">Prev</button>
            <button id="slide-next" class="px-3 py-2 rounded-lg bg-gray-100">Next</button>
          </div>
        </div>
        <div id="slider-wrapper" class="overflow-hidden rounded-2xl bg-white shadow-lg">
          <div id="slider-track" class="flex transition-transform duration-500">
            <!-- We'll programmatically ensure there are 10 slides -->
          </div>
        </div>
      </div>
    </section>
    <!-- END: Student Achievements Slider -->


    <!-- START: Testimonials -->
    <section id="testimonials" class="py-12 bg-white">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 text-center">
        <h3 class="text-3xl font-bold mb-4">What our students say</h3>
        <p class="text-gray-600 mb-8">Real feedback from learners who advanced their careers</p>
        <div class="grid md:grid-cols-3 gap-6" id="testimonials-list">
          <div class="bg-gray-50 p-6 rounded-xl shadow-sm">
            <p class="text-gray-700 mb-4">"Great course, practical projects and supportive instructors!"</p>
            <div class="flex items-center gap-3 justify-center">
              <div class="w-12 h-12 rounded-full bg-indigo-200 flex items-center justify-center font-semibold">A</div>
              <div class="text-left">
                <div class="font-bold">Ananya</div>
                <div class="text-sm text-gray-500">Full Stack Grad</div>
              </div>
            </div>
          </div>
          <div class="bg-gray-50 p-6 rounded-xl shadow-sm">
            <p class="text-gray-700 mb-4">"The certificate helped me get interviews. Highly recommend."</p>
            <div class="flex items-center gap-3 justify-center">
              <div class="w-12 h-12 rounded-full bg-green-200 flex items-center justify-center font-semibold">R</div>
              <div class="text-left">
                <div class="font-bold">Ravi</div>
                <div class="text-sm text-gray-500">Data Analyst</div>
              </div>
            </div>
          </div>
          <div class="bg-gray-50 p-6 rounded-xl shadow-sm">
            <p class="text-gray-700 mb-4">"Practical, updated content and friendly community."</p>
            <div class="flex items-center gap-3 justify-center">
              <div class="w-12 h-12 rounded-full bg-orange-200 flex items-center justify-center font-semibold">S</div>
              <div class="text-left">
                <div class="font-bold">Sahana</div>
                <div class="text-sm text-gray-500">Mobile Dev</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- END: Testimonials -->

    <!-- START: Contact Section -->
    <section id="contact-section" class="py-12 bg-gradient-to-b from-gray-50 to-white">
      <div class="max-w-7xl mx-auto px-4 sm:px-6">
        <div class="grid md:grid-cols-2 gap-8 items-center">
          <div>
            <h3 class="text-3xl font-bold mb-4">Get in touch</h3>
            <p class="text-gray-600 mb-6">Have questions? Reach out and our team will respond within 24 hours.</p>
            <ul class="text-gray-700 space-y-3">
              <li><strong>Email:</strong> support@edupro.example</li>
              <li><strong>Phone:</strong> +91 98765 43210</li>
              <li><strong>Address:</strong> 12/4 Tech Park, Hyderabad, India</li>
            </ul>
          </div>
          <div>
            <form id="contact-form" onsubmit="event.preventDefault(); alert('Thanks — we will contact you shortly!'); this.reset();">
              <div class="mb-3">
                <input required placeholder="Your name" class="w-full px-3 py-2 border rounded-lg">
              </div>
              <div class="mb-3">
                <input required type="email" placeholder="Email" class="w-full px-3 py-2 border rounded-lg">
              </div>
              <div class="mb-3">
                <textarea required placeholder="Message" rows="4" class="w-full px-3 py-2 border rounded-lg"></textarea>
              </div>
              <button class="bg-indigo-600 text-white px-6 py-2 rounded-lg">Send Message</button>
            </form>
          </div>
        </div>
      </div>
    </section>
    <!-- END: Contact Section -->

    </div>

    <div id="admin-login-screen" class="hidden max-w-md mx-auto bg-white p-8 rounded-lg shadow-lg fade-in">
      <h2 class="text-2xl font-bold text-center mb-6 text-red-600">Admin Login</h2>
      <p class="text-center text-sm text-gray-600 mb-4">Use: admin@edupro.com / admin123</p>
      <form onsubmit="handleAdminLogin(event)">
        <div class="mb-4">
          <label class="block text-gray-700 text-sm font-bold mb-2">Admin Email</label>
          <input type="email" id="admin-email"
            class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-red-500" value="admin@edupro.com"
            required>
        </div>
        <div class="mb-6">
          <label class="block text-gray-700 text-sm font-bold mb-2">Admin Password</label>
          <input type="password" id="admin-password"
            class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-red-500" value="admin123"
            required>
        </div>
        <button type="submit" class="w-full bg-red-600 text-white py-2 rounded-lg hover:bg-red-700">Login as
          Admin</button>
      </form>
      <p class="text-center mt-4">
        <button onclick="showWelcomeScreen()" class="text-gray-600 hover:underline">← Back to Main Page</button>
      </p>
    </div>

    <div id="login-form" class="hidden max-w-md mx-auto bg-white p-8 rounded-lg shadow-lg fade-in">
      <h2 class="text-2xl font-bold text-center mb-6">Login</h2>
      <form onsubmit="handleLogin(event)">
        <div class="mb-4">
          <label class="block text-gray-700 text-sm font-bold mb-2">Email</label>
          <input type="email" id="login-email"
            class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-indigo-500" required>
        </div>
        <div class="mb-6">
          <label class="block text-gray-700 text-sm font-bold mb-2">Password</label>
          <input type="password" id="login-password"
            class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-indigo-500" required>
        </div>
        <button type="submit" class="w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700">Login</button>
      </form>
      <p class="text-center mt-4">
        Don't have an account?
        <button onclick="showRegister()" class="text-indigo-600 hover:underline">Register here</button>
      </p>
    </div>

    <div id="register-form" class="hidden max-w-md mx-auto bg-white p-8 rounded-lg shadow-lg fade-in">
      <h2 class="text-2xl font-bold text-center mb-6">Register</h2>
      <form onsubmit="handleRegister(event)">
        <div class="mb-4">
          <label class="block text-gray-700 text-sm font-bold mb-2">Full Name (Used for Certificate)</label>
          <input type="text" id="register-name"
            class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-green-500" required>
          <p class="text-red-500 text-xs mt-1 font-semibold">⚠️ WARNING: Double-check this name! It cannot be
            changed and will appear on your official certificate.</p>
        </div>
        <div class="mb-4">
          <label class="block text-gray-700 text-sm font-bold mb-2">Email</label>
          <input type="email" id="register-email"
            class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-green-500" required>
        </div>
        <div class="mb-4">
          <label class="block text-gray-700 text-sm font-bold mb-2">Phone Number (10 Digits)</label>
          <input type="tel" id="register-phone" pattern="[0-9]{10}" maxlength="10"
            class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-green-500" required>
        </div>
        <div class="mb-6">
          <label class="block text-gray-700 text-sm font-bold mb-2">Password</label>
          <input type="password" id="register-password"
            class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-green-500" required>
        </div>
        <button type="submit"
          class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700">Register</button>
      </form>
      <p class="text-center mt-4">
        Already have an account?
        <button onclick="showLogin()" class="text-green-600 hover:underline">Login here</button>
      </p>
    </div>

    <div id="my-account-screen" class="hidden fade-in max-w-4xl mx-auto px-4 sm:px-6 py-8">
      <div class="bg-white rounded-2xl shadow-xl p-8 border-t-4 border-blue-500">
        <h2 class="text-4xl font-bold text-gray-800 mb-6 flex items-center">
          <svg class="w-8 h-8 mr-3 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
          </svg>
          My Account Details
        </h2>
        <div id="my-account-details-container" class="space-y-4">
        </div>
      </div>
    </div>
    <div id="dashboard-screen" class="hidden fade-in max-w-7xl mx-auto px-4 sm:px-6 py-8">
      <div class="mb-8">
        <h2 class="text-3xl font-bold text-gray-800 mb-2">Welcome back, <span id="dashboard-user-name"></span>!
        </h2>
        <p class="text-gray-600">Continue your learning journey</p>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6 mb-8">
        <div class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white p-6 rounded-2xl">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-indigo-100">Enrolled Courses</p>
              <p class="text-3xl font-bold" id="enrolled-count">0</p>
            </div>
            <div class="text-4xl opacity-80">📚</div>
          </div>
        </div>

        <div class="bg-gradient-to-r from-green-500 to-emerald-600 text-white p-6 rounded-2xl">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-green-100">Completed</p>
              <p class="text-3xl font-bold" id="completed-count">0</p>
            </div>
            <div class="text-4xl opacity-80">🏆</div>
          </div>
        </div>

        <div class="bg-gradient-to-r from-orange-500 to-red-500 text-white p-6 rounded-2xl">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-orange-100">Certificates</p>
              <p class="text-3xl font-bold" id="certificates-count">0</p>
            </div>
            <div class="text-4xl opacity-80">🎓</div>
          </div>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-8">
        <div class="lg:col-span-2">
          <div class="bg-white rounded-2xl shadow-lg p-6">
            <h3 class="text-xl font-semibold mb-4">Continue Learning</h3>
            <div id="continue-learning" class="space-y-4">
            </div>
          </div>
        </div>

        <div>
          <div class="bg-white rounded-2xl shadow-lg p-6">
            <h3 class="text-xl font-semibold mb-4">Quick Actions</h3>
            <div class="space-y-3">
              <button onclick="showCourseList()"
                class="w-full bg-indigo-600 text-white py-3 rounded-lg hover:bg-indigo-700 transition-colors">
                Browse Courses
              </button>
              <button onclick="showProfile()"
                class="w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 transition-colors">
                My Courses
              </button>
              <button onclick="showCertificates()"
                class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition-colors">
                View Certificates
              </button>
              <button onclick="showNotificationPopup()"
                class="w-full bg-yellow-500 text-gray-900 py-3 rounded-lg hover:bg-yellow-600 transition-colors relative">
                Global Notification
                <span id="notification-badge"
                  class="absolute top-0 right-0 transform -translate-y-1/2 translate-x-1/2 bg-red-600 text-white text-xs font-bold px-2 py-0.5 rounded-full hidden">
                </span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="course-list" class="hidden fade-in max-w-7xl mx-auto px-4 sm:px-6 py-8">
      <div class="text-center mb-12">
        <h2 class="text-4xl font-bold text-gray-800 mb-4">All Courses</h2>
        <p class="text-xl text-gray-600">Choose from our comprehensive course catalog</p>
      </div>

      <div class="mb-8 flex justify-center">
        <div class="bg-white rounded-full p-2 shadow-lg">
          <button onclick="filterCourses('all')"
            class="language-filter active px-6 py-2 rounded-full transition-all">All</button>
          <button onclick="filterCourses('programming')"
            class="language-filter px-6 py-2 rounded-full transition-all">Programming</button>
          <button onclick="filterCourses('design')"
            class="language-filter px-6 py-2 rounded-full transition-all">Design</button>
          <button onclick="filterCourses('business')"
            class="language-filter px-6 py-2 rounded-full transition-all">Business</button>
          <button onclick="filterCourses('data')" class="language-filter px-6 py-2 rounded-full transition-all">Data
            Science</button>
        </div>
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-8" id="courses-container"></div>
    </div>

    <div id="certificates-screen" class="hidden fade-in max-w-7xl mx-auto px-4 sm:px-6 py-8">
      <div class="text-center mb-12">
        <h2 class="text-4xl font-bold text-gray-800 mb-4">My Certificates</h2>
        <p class="text-xl text-gray-600">Your achievements and certifications</p>
      </div>
      <div id="certificates-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6">
      </div>
    </div>

    <div id="course-detail" class="hidden fade-in">
      <button onclick="showCourseList()" class="mb-4 bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700">←
        Back to Courses</button>
      <div id="course-detail-content"></div>
    </div>

    <div id="course-learning" class="hidden fade-in">
      <div class="bg-white rounded-lg shadow-lg p-6">
        <div class="flex justify-between items-center mb-6">
          <button onclick="showCourseList()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700">←
            Back to Courses</button>
          <div class="text-right">
            <div class="text-sm text-gray-600">Progress</div>
            <div class="text-lg font-semibold" id="course-progress">0%</div>
          </div>
        </div>
        <div id="course-content"></div>
      </div>
    </div>

    <div id="profile-screen" class="hidden fade-in max-w-7xl mx-auto px-4 sm:px-6 py-8">
      <h2 class="text-3xl font-bold text-center mb-8">My Courses</h2>
      <div id="enrolled-courses" class="flex flex-wrap gap-4 justify-center">
      </div>
    </div>

    <div id="certificate-screen" class="hidden fade-in">
      <div class="max-w-4xl mx-auto">
        <button onclick="showProfile()" class="mb-4 bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700">←
          Back to My
          Courses</button>
        <div id="certificate-content" class="certificate text-white p-12 rounded-lg text-center"></div>
        <div class="text-center mt-6">
          <button onclick="downloadCertificate()"
            class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 text-lg">Download
            Certificate</button>
        </div>
      </div>
    </div>

    <div id="admin-course-manager-panel" class="hidden fade-in max-w-7xl mx-auto px-4 sm:px-6 py-8">
      <h2 class="text-3xl font-bold text-gray-800 mb-8">Course Management Interface 🛠️</h2>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg h-min sticky top-24">
          <h3 class="text-xl font-semibold text-gray-800 mb-4" id="course-form-title">Add New Course</h3>
          <form id="course-management-form" onsubmit="handleCourseSubmit(event)">
            <div class="mb-3">
              <label class="block text-sm font-medium text-gray-700">Course Title</label>
              <input type="text" id="course-title" class="w-full px-3 py-2 border rounded-lg" required>
            </div>
            <div class="mb-3">
              <label class="block text-sm font-medium text-gray-700">Course ID (Unique, e.g.,
                web_dev)</label>
              <input type="text" id="course-id" class="w-full px-3 py-2 border rounded-lg" required>
            </div>
            <div class="mb-3">
              <label class="block text-sm font-medium text-gray-700">Description</label>
              <textarea id="course-description" class="w-full px-3 py-2 border rounded-lg" required></textarea>
            </div>

            <div class="mb-3 border border-indigo-200 p-3 rounded-lg bg-indigo-50">
              <h4 class="text-lg font-semibold text-indigo-700 mb-3">Course Curriculum Modules</h4>
              <div id="curriculum-modules-container" class="space-y-4">
              </div>
              <button type="button" onclick="addCurriculumModule()"
                class="w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 mt-4 text-sm flex items-center justify-center space-x-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                </svg>
                <span>Add New Day/Module</span>
              </button>
            </div>

            <div class="mb-4 flex space-x-4">
              <input type="hidden" id="original-course-id">
              <button type="submit" id="submit-course-btn"
                class="flex-1 bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700">Add
                Course</button>
              <button type="button" onclick="resetCourseForm()"
                class="bg-gray-300 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-400">Cancel</button>
            </div>
          </form>
        </div>

        <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-lg">
          <h3 class="text-xl font-semibold text-gray-800 mb-4">Current Course Catalog</h3>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead>
                <tr class="bg-gray-50">
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Title</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    ID</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Days</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Actions</th>
                </tr>
              </thead>
              <tbody id="course-manager-table-body" class="bg-white divide-y divide-gray-200">
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="bg-white p-6 rounded-xl shadow-lg mt-8">
        <h3 class="text-xl font-semibold text-gray-800 mb-4">Send Global Notification 📢</h3>
        <form onsubmit="sendGlobalNotification(event)">
          <div class="mb-3">
            <label class="block text-sm font-medium text-gray-700">Message</label>
            <input type="text" id="notification-input" placeholder="e.g., Enrollment approvals are complete for today!"
              class="w-full px-3 py-2 border rounded-lg" required>
          </div>
          <button type="submit" class="bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700">Broadcast
            Message</button>
          <p class="text-xs text-gray-500 mt-2">Current Message: <span id="current-global-notification">None</span></p>
        </form>
      </div>
    </div>
    <div id="admin-dashboard-panel" class="hidden fade-in">
      <div class="min-h-screen flex flex-col">
        <header class="bg-white shadow-md z-10">
          <div class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8 flex justify-between items-center">
            <h1 class="text-3xl font-bold text-gray-900 slide-in">Admin Enrollment Dashboard 🔑</h1>
            <div class="text-sm text-gray-500">
              Last Refreshed: <span id="last-updated" class="font-semibold text-blue-600">Loading...</span>
            </div>
          </div>
        </header>
        <main class="flex-1 p-4 sm:p-6 lg:p-8 max-w-7xl mx-auto w-full">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div id="card-total-students"
              class="card-animation bg-white p-6 rounded-xl shadow-lg border-l-4 border-blue-600">
              <div class="flex items-center justify-between">
                <div class="text-sm font-medium text-gray-500">Total Student Accounts</div>
                <svg class="h-6 w-6 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M17 20h5v-4h-5v4zm0 0l-1.336-1.336m1.336 1.336H3m3-4H2m3 4v-4m3 4v-4m3 4v-4m3 4v-4m3 4v-4m-3 4V4m3 16V4m-3 0h5m-5 0H3m3 0h12" />
                </svg>
              </div>
              <p class="text-4xl font-extrabold text-gray-900 mt-1"><span id="metric-total-students">0</span></p>
            </div>
            <div id="card-total-active-users"
              class="card-animation bg-white p-6 rounded-xl shadow-lg border-l-4 border-red-600">
              <div class="flex items-center justify-between">
                <div class="text-sm font-medium text-gray-500">Total Active Users</div>
                <svg class="h-6 w-6 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M13 10V3L4 14h7v7l9-11h-7z" />
                </svg>
              </div>
              <p class="text-4xl font-extrabold text-gray-900 mt-1"><span id="metric-total-active-users">0</span></p>
            </div>
            <div id="card-total-certificates"
              class="card-animation bg-white p-6 rounded-xl shadow-lg border-l-4 border-green-600">
              <div class="flex items-center justify-between">
                <div class="text-sm font-medium text-gray-500">Courses Completed (Certified)</div>
                <svg class="h-6 w-6 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.01 12.01 0 002.5 14c0 1.491.31 2.923.863 4.264m18.774-11.28A12.01 12.01 0 0021.5 14c0 1.491-.31 2.923-.863 4.264M18 18h-4.264l-.5-1.5-.5 1.5H6m12 0a2 2 0 100 4 2 2 0 000-4z" />
                </svg>
              </div>
              <p class="text-4xl font-extrabold text-gray-900 mt-1"><span id="metric-total-certificates">0</span></p>
            </div>
          </div>

          <div class="grid grid-cols-1 gap-6 mb-8">
            <div class="bg-white p-6 rounded-xl shadow-lg card-animation w-full">
              <h2 class="text-xl font-semibold text-gray-800 mb-4">Course Enrollment Distribution (Live
                Data)</h2>
              <div style="height: 300px;">
                <canvas id="courseChart"></canvas>
              </div>
            </div>
            <div class="bg-white p-6 rounded-xl shadow-lg card-animation w-full grid grid-cols-1 md:grid-cols-4 gap-4">
              <div>
                <label for="admin-student-search" class="block text-sm font-medium text-gray-700">Search
                  Name/Email/Phone</label>
                <input type="text" id="admin-student-search" placeholder="E.g., Alice Johnson"
                  class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:ring-blue-500 focus:border-blue-500 filter-transition">
              </div>
              <div>
                <label for="admin-course-filter" class="block text-sm font-medium text-gray-700">Filter
                  by Course</label>
                <select id="admin-course-filter"
                  class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:ring-blue-500 focus:border-blue-500 filter-transition bg-white">
                  <option value="all">All Courses</option>
                </select>
              </div>
              <div>
                <label for="admin-status-filter" class="block text-sm font-medium text-gray-700">Filter
                  by Enrollment Status</label>
                <select id="admin-status-filter"
                  class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:ring-blue-500 focus:border-blue-500 filter-transition bg-white">
                  <option value="all">Any Status</option>
                  <option value="true">Active (True)</option>
                  <option value="false">Pending (False)</option>
                </select>
              </div>
              <div>
                <label for="admin-online-filter" class="block text-sm font-medium text-gray-700">Filter
                  by Online Status</label>
                <select id="admin-online-filter"
                  class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:ring-blue-500 focus:border-blue-500 filter-transition bg-white">
                  <option value="all">All</option>
                  <option value="online">Online</option>
                  <option value="offline">Offline</option>
                </select>
              </div>
            </div>
          </div>

          <div class="bg-white p-6 rounded-xl shadow-lg card-animation">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">
              Student Enrollment Records
              <span id="approval-metrics" class="ml-4 text-sm font-normal text-gray-600">
                (Active: <span id="metric-approvals" class="font-semibold text-green-600">0</span> /
                Pending: <span id="metric-revokes" class="font-semibold text-orange-600">0</span>)
              </span>
            </h2>
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-200">
                <thead>
                  <tr class="bg-gray-50">
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Student Name</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Email</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Course Title</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Status</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Action</th>
                  </tr>
                </thead>
                <tbody id="admin-table-body" class="bg-white divide-y divide-gray-200">
                </tbody>
              </table>
              <div id="admin-no-results" class="hidden text-center py-8 text-gray-500">No enrollment
                records found matching the criteria.</div>
            </div>
            <div class="flex justify-between items-center mt-4">
              <div class="flex space-x-2">
                <button onclick="handlePagination('prev')"
                  class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg text-sm hover:bg-gray-300 transition-colors hidden"
                  id="prev-page-btn">←</button>
                <button onclick="handlePagination('next')"
                  class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg text-sm hover:bg-gray-300 transition-colors hidden"
                  id="next-page-btn">→</button>
              </div>
              <span class="text-sm text-gray-600" id="pagination-info">Displaying 0 records</span>
            </div>
          </div>
        </main>
      </div>
    </div>
  </div>

  <div id="admin-user-details-modal" class="modal hidden">
    <div class="modal-content w-full max-w-xl admin-profile-card">
      <div class="flex justify-between items-center pb-4 mb-4 border-b border-indigo-200">
        <h2 class="text-3xl font-extrabold text-indigo-900" id="modal-user-name">Student Details</h2>
        <button onclick="closeAdminUserDetails()"
          class="text-gray-500 hover:text-red-700 p-2 rounded-full hover:bg-red-50">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
            </path>
          </svg>
        </button>
      </div>

      <div id="modal-user-info" class="p-4 bg-indigo-50 rounded-xl shadow-inner mb-6 space-y-2 text-gray-700">
      </div>

      <div class="mt-6 flex justify-between space-x-3 pt-4">
        <button id="disable-user-btn"
          onclick="toggleUserDisableStatus(document.getElementById('admin-user-details-modal').getAttribute('data-user-id'))"
          class="bg-yellow-500 text-gray-900 px-4 py-2 rounded-lg text-sm hover:bg-yellow-600 transition-colors flex-1 shadow-md">Disable
          User</button>
        <button id="delete-user-btn"
          onclick="deleteUserPermanently(document.getElementById('admin-user-details-modal').getAttribute('data-user-id'))"
          class="bg-red-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-red-700 transition-colors flex-1 shadow-md">Delete
          User Permanently</button>
      </div>
      <div class="mt-8">
        <h3 class="text-xl font-bold text-gray-800 border-b pb-2 mb-4 flex items-center">
          <span class="mr-2 text-indigo-600">📚</span> Enrolled Courses (<span id="modal-enrolled-count">0</span>)
        </h3>
        <div id="modal-course-list" class="space-y-3">
        </div>
      </div>
    </div>
  </div>
  <div id="notification-modal" class="modal hidden">
    <div class="modal-content w-full max-w-lg bg-white p-6 rounded-xl shadow-2xl border-t-8 border-yellow-500">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl font-bold text-gray-800 flex items-center">
          <span class="mr-3 text-yellow-600">📢</span> Global Announcement
        </h2>
        <button onclick="closeNotificationPopup()" class="text-gray-500 hover:text-gray-900">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
            </path>
          </svg>
        </button>
      </div>
      <div id="notification-content" class="bg-yellow-50 p-4 rounded-lg text-yellow-900 border border-yellow-200">
        <p class="font-medium text-lg">No active announcements.</p>
      </div>
      <p class="text-xs text-gray-500 mt-4 text-right">Last updated: <span id="notification-timestamp">N/A</span>
      </p>
    </div>
  </div>
  <script>
    // Application State
    let currentCourse = null;
    let currentDay = 1;
    let currentUser = null;
    const PAYMENT_LINK = 'https://rzp.io/rzp/MdrDDje';
    let isAdminLoggedIn = false;
    const ADMIN_EMAIL = 'admin@edupro.com';
    const ADMIN_PASSWORD = 'admin123';
    let courseChartInstance = null;

    // Pagination state
    const RECORDS_PER_PAGE = 20;
    let currentPage = 1;

    // Configuration for the Rich Text Editor (Colors & Styles)
    const RICH_TEXT_OPTIONS = {
      colors: ['#ef4444', '#f97316', '#10b981', '#3b82f6', '#8b5cf6', '#1f2937'], // Red, Orange, Green, Blue, Purple, Dark
      bgColors: ['#fee2e2', '#ffedd5', '#d1fae5', '#dbeafe', '#ede9fe', '#f3f4f6'], // Corresponding Light Backgrounds
      fontNames: ['Arial', 'Verdana', 'Times New Roman', 'Georgia'],
    };


    // Sample Data: COURSE IDs must be unique strings (rich content structure)
    // CRITICAL FIX: This initial data structure remains, but the application logic
    // now ensures it is overwritten by/merged with data from Firebase on load.
    let courses = [{
      id: "web_dev",
      title: "Full Stack Web Development",
      description: "Master modern web development with React, Node.js, and databases",
      duration: "10 days",
      level: "Beginner",
      icon: "💻",
      category: "programming",
      rating: 4.9,
      students: 2847,
      curriculum: [{
        title: "HTML & CSS Fundamentals",
        content: "<p>Welcome to Day 1! We dive into <strong>semantic HTML5</strong>, <strong>Flexbox</strong>, and <strong>CSS Grid</strong>. <strong>Task</strong>: Build a responsive header and footer layout. The core idea is to structure content clearly. 📘</p><h4>Core Concepts</h4><ul><li><strong>Hyper Text:</strong> Text within Text. This is what links pages together.</li><li><strong>Markup Language:</strong> Used to apply layout and formatting to documents.</li><li><strong>Web Page:</strong> A document (typically HTML) rendered by a web browser.</li></ul><p style='background-color:#fee2e2; color:#ef4444; padding: 10px;'>This module is the <strong>foundation</strong>. Never underestimate the power of pure HTML and CSS!</p>",
        video_url: "https://www.youtube.com/embed/videoseries?list=PL4-Tl6P4lXwR8iGzXz_k4q6rXm6e_vQ5L" // Mock embed link
      }, {
        title: "JavaScript ES6+",
        content: "<p>Day 2 covers modern JavaScript features: <strong>Arrow Functions</strong>, <strong>Promises</strong>, and <strong>Async/Await</strong>. These are critical for building dynamic applications like this one.</p><h4>Why Learn HTML? The Foundation of the Web</h4><p>Even as we dive into JS, understanding <strong>HTML</strong> is essential:</p><ol><li><strong>Semantic Structure:</strong> Use &lt;article&gt;, &lt;nav&gt;, &lt;footer&gt; to define meaning.</li><li><strong>Accessibility (a11y):</strong> Core accessibility is built into native HTML elements.</li><li><strong>DOM Manipulation:</strong> JavaScript <em>must</em> interact with the Document Object Model (DOM), which is the programming interface for HTML.</li></ol><p><strong>Task</strong>: Create a simple promise chain. 💡</p>",
        video_url: "https://www.youtube.com/embed/videoseries?list=PL4-Tl6P4lXwR8iGzXz_k4q6rXm6e_vQ5L"
      }, {
        title: "React Components",
        content: "<h2>What is CSS? The Art of Styling the Web</h2><p><strong>CSS</strong> stands for <strong>Cascading Style Sheets</strong>. If HTML is the skeleton, CSS is the <strong>skin, clothes, and makeup</strong>. It describes the presentation of the HTML document, including colors, layout, and fonts.</p><p>This separation is what lets you apply a complete visual overhaul to an entire website by changing just a few CSS files. Imagine transforming a plain document into a stunning, responsive layout with sophisticated typography and vibrant colors—that's the power of CSS.</p><h4>Types of CSS Styling</h4><ul><li><strong>External CSS:</strong> Styles defined in a separate file (<code>styles.css</code>). This keeps style and structure completely isolated, allowing reuse. The entire site's background could be a deep, mesmerizing <span style='color:#3b82f6;'>Blue</span>.</li><li><strong>Internal CSS:</strong> Styles defined within <style> tags. Example: applying a special block with a subtle, radiant <span style='color:#f59e0b;'>Amber</span> border.</li><li><strong>Inline CSS:</strong> Styles applied directly to an element. (e.g., giving a button a temporary, cheerful <span style='color:#ef4444;'>Coral Pink</span> background).</li></ul><p>Learn how to build reusable components in <strong>React</strong>. Focus on functional components and hooks (useState). ⚛️</p>",
        video_url: "https://www.youtube.com/embed/videoseries?list=PL4-Tl6P4lXwR8iGzXz_k4q6rXm6e_vQ5L"
      }, {
        title: "State Management",
        content: "<p>Understand complex state with Redux/Context API. We simulate an e-commerce cart. Efficient state management is crucial for large applications. <strong>Task</strong>: Implement global authentication state. 🛒</p>",
        video_url: "https://www.youtube.com/embed/videoseries?list=PL4-Tl6P4lXwR8iGzXz_k4q6rXm6e_vQ5L"
      }, {
        title: "Node.js Backend",
        content: "<p>Introduction to server-side JavaScript using Node.js. Focus on setting up the server and basic routing. Node is the core technology powering many modern APIs. <strong>Task</strong>: Create a simple 'Hello World' server. ⚙️</p>",
        video_url: "https://www.youtube.com/embed/videoseries?list=PL4-Tl6P4lXwR8iGzXz_k4q6rXm6e_vQ5L"
      }, {
        title: "Express.js Framework",
        content: "<p>Simplifying backend development with Express. Learn middleware and REST API structure. Express is the industry standard for lightweight backend services. <strong>Task</strong>: Define CRUD endpoints for user accounts. 🚀</p>",
        video_url: "https://www.youtube.com/embed/videoseries?list=PL4-Tl6P4lXwR8iGzXz_k4q6rXm6e_vQ5L"
      }, {
        title: "Database Integration",
        content: "<p>Connecting the Express app to a NoSQL database (MongoDB/Mongoose simulation). You'll learn how data persistence works. <strong>Task</strong>: Store and retrieve user data from the simulated DB. 💾</p>",
        video_url: "https://www.youtube.com/embed/videoseries?list=PL4-Tl6P4lXwR8iGzXz_k4q6rXm6e_vQ5L"
      }, {
        title: "API Development",
        content: "<p>Building robust and secure APIs. Focus on error handling and data validation. A good API is the backbone of any distributed system. <strong>Task</strong>: Validate incoming enrollment data. 🛡️</p>",
        video_url: "https://www.youtube.com/embed/videoseries?list=PL4-Tl6P4lXwR8iGzXz_k4q6rXm6e_vQ5L"
      }, {
        title: "Authentication",
        content: "<p>Implement user authentication using JSON Web Tokens (JWT). This is essential for protecting user resources. <strong>Task</strong>: Create signup/login functionality with token generation. 🔑</p>",
        video_url: "https://www.youtube.com/embed/videoseries?list=PL4-Tl6P4lXwR8iGzXz_k4q6rXm6e_vQ5L"
      }, {
        title: "Deployment",
        content: "<p>Final step: deploy the full stack application to a cloud provider simulation. Learn about hosting, domains, and environment variables. <strong>Task</strong>: Simulate production build and deployment steps. ✅</p>",
        video_url: "https://www.youtube.com/embed/videoseries?list=PL4-Tl6P4lXwR8iGzXz_k4q6rXm6e_vQ5L"
      },],
    }, {
      id: "data_sci",
      title: "Data Science & Analytics",
      description: "Master Python, machine learning, and data visualization",
      duration: "10 days",
      level: "Intermediate",
      icon: "📊",
      category: "data",
      rating: 4.8,
      students: 1923,
      curriculum: [
        { title: "Python for Data Science", content: "<p>Introduction to Python syntax, libraries, and basic data structures for data manipulation. <strong>Task</strong>: Set up your Jupyter environment. 🐍</p>", video_url: "" },
        { title: "NumPy & Pandas", content: "<p>Mastering the fundamental libraries for numerical operations and data analysis. Learn about DataFrames and Series. <strong>Task</strong>: Load and clean a CSV file.</p>", video_url: "" },
        { title: "Data Cleaning", content: "<p>Techniques for handling missing values, outliers, and incorrect data types. Garbage in, garbage out! <strong>Task</strong>: Implement three different imputation methods.</p>", video_url: "" },
        { title: "Statistical Analysis", content: "<p>Understanding descriptive and inferential statistics. Hypothesis testing and p-values. <strong>Task</strong>: Perform an A/B test analysis.</p>", video_url: "" },
        { title: "Data Visualization", content: "<p>Using Matplotlib and Seaborn to create beautiful and informative charts. <strong>Task</strong>: Create a stunning heat map with custom color palettes. 🎨</p>", video_url: "" },
        { title: "Machine Learning Basics", content: "<p>Introduction to supervised vs. unsupervised learning. Linear Regression and Logistic Regression. <strong>Task</strong>: Build your first predictive model.</p>", video_url: "" },
        { title: "Scikit-learn", content: "<p>The go-to library for ML in Python. Pipeline creation and model training. <strong>Task</strong>: Implement k-fold cross-validation.</p>", video_url: "" },
        { title: "Model Evaluation", content: "<p>Metrics like precision, recall, F1-score, and ROC curves. Understanding model performance limitations. <strong>Task</strong>: Compare performance across three algorithms.</p>", video_url: "" },
        { title: "Deep Learning Intro", content: "<p>The basics of neural networks, layers, and activation functions. Keras/TensorFlow intro. <strong>Task</strong>: Build a simple feed-forward network.</p>", video_url: "" },
        { title: "Capstone Project", content: "<p>Apply everything you've learned to a real-world dataset. Prepare your presentation and portfolio piece. <strong>Task</strong>: Submit your final project and code repository. ✅</p>", video_url: "" },
      ]
    }, {
      id: "digital_mkt",
      title: "Digital Marketing Mastery",
      description: "Complete digital marketing strategy and execution",
      duration: "10 days",
      level: "Beginner",
      icon: "📈",
      category: "business",
      rating: 4.7,
      students: 3421,
      curriculum: [
        { title: "Marketing Strategy", content: "<p>Defining your target audience, value proposition, and marketing goals. <strong>Task</strong>: Complete a SWOT analysis for a sample brand. 📋</p>", video_url: "" },
        { title: "SEO Optimization", content: "<p>On-page, off-page, and technical SEO fundamentals. Keyword research. <strong>Task</strong>: Optimize a blog post for a primary keyword.</p>", video_url: "" },
        { title: "Content Marketing", content: "<p>Creating engaging content that converts. Content calendars and distribution. <strong>Task</strong>: Outline a 30-day content calendar.</p>", video_url: "" },
        { title: "Social Media Strategy", content: "<p>Platform-specific strategies (Facebook, Instagram, LinkedIn). Community engagement. <strong>Task</strong>: Develop a crisis communication plan.</p>", video_url: "" },
        { title: "Email Campaigns", content: "<p>Building lists, segmentation, and automated drip campaigns. A/B testing subject lines. <strong>Task</strong>: Design a 3-part welcome email sequence. 📧</p>", video_url: "" },
        { title: "Google Analytics", content: "<p>Tracking traffic, conversions, and user behavior. Setting up goals. <strong>Task</strong>: Analyze bounce rate across different channels.</p>", video_url: "" },
        { title: "Paid Advertising", content: "<p>PPC fundamentals (Google Ads, Social Media Ads). Budget management. <strong>Task</strong>: Create an ad group with optimized creative and copy.</p>", video_url: "" },
        { title: "Conversion Optimization", content: "<p>CRO. Improving landing pages, calls to action (CTAs), and user flow. <strong>Task</strong>: Redesign a checkout page to reduce cart abandonment.</p>", video_url: "" },
        { title: "Brand Building", content: "<p>Developing a consistent brand voice and visual identity. Trust and authority. <strong>Task</strong>: Write a brand style guide summary.</p>", video_url: "" },
        { title: "Campaign Analysis", content: "<p>Measuring ROI and generating actionable reports. Lifetime value (LTV). <strong>Task</strong>: Present a final marketing campaign report. 📊</p>", video_url: "" },
      ]
    }, {
      id: "mobile_dev",
      title: "Mobile App Development",
      description: "Build cross-platform mobile apps with React Native",
      duration: "10 days",
      level: "Intermediate",
      icon: "📱",
      category: "programming",
      rating: 4.6,
      students: 1567,
      curriculum: [
        { title: "React Native Setup", content: "<p>Installing dependencies and setting up your development environment (Expo/CLI). <strong>Task</strong>: Run your first 'Hello Mobile' app on a simulator.</p>", video_url: "" },
        { title: "Components & Navigation", content: "<p>Functional components, basic styling, and implementing React Navigation. <strong>Task</strong>: Create a tab bar navigation structure.</p>", video_url: "" },
        { title: "State Management", content: "<p>Using React Hooks (useState, useContext) for local and global state. <strong>Task</strong>: Build a simple counter app with global state.</p>", video_url: "" },
        { title: "API Integration", content: "<p>Fetching data from REST APIs using Axios or Fetch. Handling loading and error states. <strong>Task</strong>: Display a list of items fetched from a public API.</p>", video_url: "" },
        { title: "Native Features", content: "<p>Accessing device features like Camera, Geolocation, and AsyncStorage. <strong>Task</strong>: Implement photo upload functionality.</p>", video_url: "" },
        { title: "Push Notifications", content: "<p>Setting up Firebase Cloud Messaging (FCM) or Expo Notifications. <strong>Task</strong>: Schedule a local notification.</p>", video_url: "" },
        { title: "App Store Guidelines", content: "<p>Understanding Apple and Google Play policies and requirements. <strong>Task</strong>: Prepare app metadata and screenshots.</p>", video_url: "" },
        { title: "Testing & Debugging", content: "<p>Using Chrome DevTools and native debugging tools. Jest for unit testing. <strong>Task</strong>: Write tests for a utility function.</p>", video_url: "" },
        { title: "Performance Optimization", content: "<p>Improving startup time, rendering performance, and bundle size. <strong>Task</strong>: Analyze and reduce component re-renders.</p>", video_url: "" },
        { title: "Publishing", content: "<p>Building production bundles and submitting your app to the stores. <strong>Task</strong>: Generate signed APK/IPA files. ✅</p>", video_url: "" },
      ]
    }, {
      id: "cyber_sec",
      title: "Cybersecurity Fundamentals",
      description: "Learn ethical hacking and security best practices",
      duration: "10 days",
      level: "Advanced",
      icon: "🔒",
      category: "programming",
      rating: 4.9,
      students: 892,
      curriculum: [
        { title: "Security Principles", content: "<p>The CIA Triad (Confidentiality, Integrity, Availability). Introduction to threat modeling. <strong>Task</strong>: Define a security policy for a small business.</p>", video_url: "" },
        { title: "Network Security", content: "<p>Firewalls, VPNs, IDS/IPS. Understanding TCP/IP vulnerabilities. <strong>Task</strong>: Configure a mock firewall to block specific ports.</p>", video_url: "" },
        { title: "Cryptography", content: "<p>Symmetric vs. Asymmetric encryption, hashing, and digital signatures. <strong>Task</strong>: Implement a basic RSA encryption/decryption function.</p>", video_url: "" },
        { title: "Vulnerability Assessment", content: "<p>Using tools like Nessus and OpenVAS to scan for vulnerabilities. CVSS scoring. <strong>Task</strong>: Analyze a mock scan report and prioritize patches.</p>", video_url: "" },
        { title: "Penetration Testing", content: "<p>The phases of penetration testing. Web application attacks (XSS, SQLi). <strong>Task</strong>: Perform a simulated SQL Injection attack. 🛡️</p>", video_url: "" },
        { title: "Incident Response", content: "<p>Containment, eradication, and recovery. Creating an Incident Response Plan (IRP). <strong>Task</strong>: Outline the first 5 steps after detecting a breach.</p>", video_url: "" },
        { title: "Security Tools", content: "<p>Introduction to Kali Linux, Wireshark, and Metasploit. <strong>Task</strong>: Capture and analyze network traffic.</p>", video_url: "" },
        { title: "Compliance Standards", content: "<p>Overview of GDPR, HIPAA, and ISO 27001. Data privacy laws. <strong>Task</strong>: Identify 3 compliance requirements for a health tech app.</p>", video_url: "" },
        { title: "Risk Management", content: "<p>Identifying, assessing, and mitigating security risks. Qualitative vs. quantitative risk analysis. <strong>Task</strong>: Create a risk matrix for an e-commerce platform.</p>", video_url: "" },
        { title: "Capstone Project", content: "<p>Full mock security audit and defense plan for a web application. <strong>Task</strong>: Submit the final audit report. ✅</p>", video_url: "" },
      ]
    }, {
      id: "aws_cloud",
      title: "Cloud Computing with AWS",
      description: "Master Amazon Web Services and cloud architecture",
      duration: "10 days",
      level: "Intermediate",
      icon: "☁️",
      category: "programming",
      rating: 4.8,
      students: 2156,
      curriculum: [
        { title: "AWS Fundamentals", content: "<p>The core services (Compute, Storage, Networking, Database). Global infrastructure. <strong>Task</strong>: Create an AWS Free Tier account.</p>", video_url: "" },
        { title: "EC2 & VPC", content: "<p>Launching and managing Elastic Compute Cloud (EC2) instances. Virtual Private Cloud (VPC) networking. <strong>Task</strong>: Launch a secure T2.micro instance.</p>", video_url: "" },
        { title: "S3 & Storage", content: "<p>Simple Storage Service (S3), EBS, and Glacier. Bucket policies and versioning. <strong>Task</strong>: Host a static website on S3.</p>", video_url: "" },
        { title: "RDS & Databases", content: "<p>Relational Database Service (RDS) vs. DynamoDB (NoSQL). Backup and replication. <strong>Task</strong>: Provision a PostgreSQL instance on RDS.</p>", video_url: "" },
        { title: "Lambda Functions", content: "<p>Serverless computing with AWS Lambda. Event-driven architecture. <strong>Task</strong>: Create a Lambda function triggered by an S3 upload. ⚙️</p>", video_url: "" },
        { title: "CloudFormation", content: "<p>Infrastructure as Code (IaC). Defining infrastructure using JSON/YAML templates. <strong>Task</strong>: Deploy a simple web stack using a CloudFormation template.</p>", video_url: "" },
        { title: "Security & IAM", content: "<p>Identity and Access Management (IAM). Users, groups, roles, and policies. <strong>Task</strong>: Create an IAM user with limited S3 access.</p>", video_url: "" },
        { title: "Monitoring & Logging", content: "<p>Using CloudWatch for metrics, alarms, and logs. <strong>Task</strong>: Set an alarm for high CPU utilization.</p>", video_url: "" },
        { title: "DevOps Integration", content: "<p>CodePipeline and CodeDeploy for CI/CD. <strong>Task</strong>: Deploy an update through a mock pipeline.</p>", video_url: "" },
        { title: "Certification Prep", content: "<p>Review of key services for the AWS Certified Cloud Practitioner exam. <strong>Task</strong>: Complete the final practice exam. ✅</p>", video_url: "" },
      ]
    }, {
      id: "ui_ux",
      title: "UI/UX Design Professional",
      description: "Create stunning user experiences and interfaces",
      duration: "10 days",
      level: "Beginner",
      icon: "🎨",
      category: "design",
      rating: 4.7,
      students: 2834,
      curriculum: [
        { title: "Design Thinking", content: "<p>Empathize, Define, Ideate, Prototype, Test. The five stages of Design Thinking. <strong>Task</strong>: Conduct a user interview (mock) and synthesize findings.</p>", video_url: "" },
        { title: "User Research", content: "<p>Surveys, A/B testing, card sorting. Creating user personas and empathy maps. <strong>Task</strong>: Develop three distinct user personas for a new app.</p>", video_url: "" },
        { title: "Wireframing", content: "<p>Low-fidelity vs. high-fidelity wireframes. Information architecture. <strong>Task</strong>: Sketch a wireframe for a mobile login flow.</p>", video_url: "" },
        { title: "Prototyping", content: "<p>Creating interactive prototypes using Figma or Sketch. User flow visualization. <strong>Task</strong>: Build a clickable prototype of the app's core feature.</p>", video_url: "" },
        { title: "Visual Design", content: "<p>Color theory, typography, and visual hierarchy. Choosing a brand palette. <strong>Task</strong>: Design a mood board inspired by a <strong>Royal Purple</strong> and <strong>Goldenrod Yellow</strong> palette.</p>", video_url: "" },
        { title: "Interaction Design", content: "<p>Micro-interactions, animations, and transitions. Usability heuristics. <strong>Task</strong>: Design an engaging loading animation.</p>", video_url: "" },
        { title: "Usability Testing", content: "<p>Planning and running usability tests. Analyzing quantitative and qualitative data. <strong>Task</strong>: Write a usability test script and a summary report.</p>", video_url: "" },
        { title: "Design Systems", content: "<p>Creating reusable components and documentation. Consistency and scalability. <strong>Task</strong>: Build a small component library in Figma.</p>", video_url: "" },
        { title: "Figma Mastery", content: "<p>Advanced features: auto layout, variants, and collaboration tools. <strong>Task</strong>: Collaborate on a design file with a partner.</p>", video_url: "" },
        { title: "Portfolio Building", content: "<p>Curating your best work and presenting your design rationale. <strong>Task</strong>: Finalize two case studies for your portfolio. ✅</p>", video_url: "" },
      ]
    }, {
      id: "ai_ml",
      title: "Artificial Intelligence & ML",
      description: "Deep dive into AI, neural networks, and machine learning",
      duration: "10 days",
      level: "Advanced",
      icon: "🤖",
      category: "data",
      rating: 4.9,
      students: 1245,
      curriculum: [
        { title: "AI Fundamentals", content: "<p>History of AI, different types of AI (Narrow, General, Super). Introduction to common terminology. <strong>Task</strong>: Write a short essay on the Turing Test.</p>", video_url: "" },
        { title: "Machine Learning Algorithms", content: "<p>Decision Trees, Support Vector Machines (SVM), and clustering algorithms. <strong>Task</strong>: Implement K-Means clustering on an unlabeled dataset.</p>", video_url: "" },
        { title: "Neural Networks", content: "<p>Perceptrons, backpropagation, and loss functions. The structure of a basic neural network. <strong>Task</strong>: Manually calculate one step of backpropagation.</p>", video_url: "" },
        { title: "Deep Learning", content: "<p>Introduction to Convolutional Neural Networks (CNN) for images and Recurrent Neural Networks (RNN) for sequences. <strong>Task</strong>: Build a simple CNN for image classification.</p>", video_url: "" },
        { title: "Computer Vision", content: "<p>Image processing, object detection, and facial recognition. OpenCV basics. <strong>Task</strong>: Implement edge detection on an image.</p>", video_url: "" },
        { title: "Natural Language Processing", content: "<p>Tokenization, stemming, lemmatization. Sentiment analysis and text generation. <strong>Task</strong>: Build a simple sentiment analyzer using TF-IDF.</p>", video_url: "" },
        { title: "TensorFlow & PyTorch", content: "<p>Working with the leading deep learning frameworks. Data loaders and GPUs. <strong>Task</strong>: Retrain a pre-trained model (Transfer Learning).</p>", video_url: "" },
        { title: "Model Deployment", content: "<p>Saving models and serving them via a REST API (e.g., Flask). MLOps fundamentals. <strong>Task</strong>: Deploy a trained model endpoint locally.</p>", video_url: "" },
        { title: "AI Ethics", content: "<p>Bias, fairness, accountability, and transparency in AI systems. <strong>Task</strong>: Analyze a case study on algorithmic bias.</p>", video_url: "" },
        { title: "Industry Applications", content: "<p>Exploring AI in finance, healthcare, and self-driving cars. <strong>Task</strong>: Final project submission. ✅</p>", video_url: "" },
      ]
    }, {
      id: "blockchain",
      title: "Blockchain & Web3 Development",
      description: "Build decentralized applications and smart contracts",
      duration: "10 days",
      level: "Advanced",
      icon: "⛓️",
      category: "programming",
      rating: 4.6,
      students: 743,
      curriculum: [
        { title: "Blockchain Fundamentals", content: "<p>How distributed ledger technology works. Hashing and immutability. <strong>Task</strong>: Implement a simple, local blockchain structure in Python.</p>", video_url: "" },
        { title: "Ethereum & Solidity", content: "<p>The Ethereum Virtual Machine (EVM). Introduction to the Solidity programming language. <strong>Task</strong>: Set up a local development environment (Ganache).</p>", video_url: "" },
        { title: "Smart Contracts", content: "<p>Writing, compiling, and deploying your first contract. State variables and functions. <strong>Task</strong>: Deploy a basic <code>Storage</code> contract to a local testnet</p>.", video_url: "" },
        { title: "Web3.js Integration", content: "<p>Interacting with the blockchain from a frontend application. Connecting wallets (MetaMask). <strong>Task</strong>: Read a variable from your deployed contract using Web3.js.</p>", video_url: "" },
        { title: "DeFi Protocols", content: "<p>Decentralized Finance basics. Lending, borrowing, and stablecoins. <strong>Task</strong>: Explain the mechanism of a liquidity pool.</p>", video_url: "" },
        { title: "NFT Development", content: "<p>ERC-721 and ERC-1155 standards. Metadata and IPFS storage. <strong>Task</strong>: Mint a mock NFT using OpenZeppelin standards.</p>", video_url: "" },
        { title: "Security Best Practices", content: "<p>Common smart contract vulnerabilities (reentrancy, overflow). Auditing tools. <strong>Task</strong>: Identify and fix a vulnerability in a sample contract.</p>", video_url: "" },
        { title: "Testing & Deployment", content: "<p>Using frameworks like Truffle or Hardhat for automated testing and staging deployment. <strong>Task</strong>: Write unit tests for your NFT contract.</p>", video_url: "" },
        { title: "Gas Optimization", content: "<p>Reducing transaction costs and improving efficiency. Storage vs. memory usage. <strong>Task</strong>: Refactor a contract function to save gas.</p>", video_url: "" },
        { title: "DApp Project", content: "<p>Building a full decentralized application (DApp). <strong>Task</strong>: Submit your DApp code and live demo video. ✅</p>", video_url: "" },
      ]
    }, {
      id: "agile_pm",
      title: "Agile Project Management",
      description: "Master Scrum, Kanban, and modern project leadership",
      duration: "10 days",
      level: "Beginner",
      icon: "📋",
      category: "business",
      rating: 4.5,
      students: 1876,
      curriculum: [
        { title: "Agile Principles", content: "<p>The Agile Manifesto and its 12 principles. Waterfall vs. Agile comparison. <strong>Task</strong>: Explain the importance of 'working software over comprehensive documentation'.</p>", video_url: "" },
        { title: "Scrum Framework", content: "<p>Roles (Scrum Master, Product Owner, Development Team) and artifacts (Product Backlog, Sprint Backlog). <strong>Task</strong>: Define the first 10 items for a new Product Backlog.</p>", video_url: "" },
        { title: "Kanban Method", content: "<p>Visualizing workflow, limiting work in progress (WIP), and managing flow. <strong>Task</strong>: Design a 5-column Kanban board for a software team.</p>", video_url: "" },
        { title: "Sprint Planning", content: "<p>Estimating user stories (Story Points) and defining the Sprint Goal. <strong>Task</strong>: Conduct a mock Poker Planning session.</p>", video_url: "" },
        { title: "Team Leadership", content: "<p>Servant leadership, coaching, and conflict resolution. <strong>Task</strong>: Write a debrief on a simulated team conflict scenario.</p>", video_url: "" },
        { title: "Stakeholder Management", content: "<p>Identifying and engaging stakeholders. Managing expectations and communication. <strong>Task</strong>: Create a stakeholder engagement plan.</p>", video_url: "" },
        { title: "Risk Assessment", content: "<p>Identifying and mitigating project risks in an iterative environment. <strong>Task</strong>: Perform a qualitative risk assessment on a new feature.</p>", video_url: "" },
        { title: "Quality Assurance", content: "<p>Incorporating quality into every stage of development. Definition of Done (DoD). <strong>Task</strong>: Define a DoD for a simple website feature.</p>", video_url: "" },
        { title: "Project Tools", content: "<p>Using Jira, Trello, or Azure DevOps for backlog management. <strong>Task</strong>: Create and link a user story and a bug report.</p>", video_url: "" },
        { title: "PMP Preparation", content: "<p>Overview of Project Management Professional (PMP) concepts related to Agile. <strong>Task</strong>: Complete the final practice exam. ✅</p>", video_url: "" },
      ]
    }, {
      id: "python_prog",
      title: "Python Programming Mastery",
      description: "Complete Python course from basics to advanced concepts",
      duration: "10 days",
      level: "Beginner",
      icon: "🐍",
      category: "programming",
      rating: 4.8,
      students: 3567,
      curriculum: [
        { title: "Python Syntax", content: "<p>Variables, data types (strings, integers, booleans), and basic operators. <strong>Task</strong>: Write a program to swap two variables without a temporary variable.</p>", video_url: "" },
        { title: "Data Structures", content: "<p>Lists, Tuples, Dictionaries, and Sets. When to use which structure. <strong>Task</strong>: Create a function to count word frequency in a list of strings.</p>", video_url: "" },
        { title: "Object-Oriented Programming", content: "<p>Classes, objects, inheritance, and encapsulation. <strong>Task</strong>: Create a class structure for a simple library management system.</p>", video_url: "" },
        { title: "File Handling", content: "<p>Reading from and writing to text files and CSV files. Context managers (<code>with</code> statement). <strong>Task</strong>: Read user data from a file and store it in a dictionary.</p>", video_url: "" },
        { title: "Error Handling", content: "<p>Using <code>try</code>, <code>except</code>, <code>else</code>, and <code>finally</code> to manage runtime errors gracefully. <strong>Task</strong>: Write a function that handles <code>ZeroDivisionError</code> and <code>TypeError</code>.</p>", video_url: "" },
        { title: "Libraries & Modules", content: "<p>Installing and importing external packages (e.g., requests, beautifulsoup). <strong>Task</strong>: Build a simple weather checker using an external API library.</p>", video_url: "" },
        { title: "Web Scraping", content: "<p>Using requests and Beautiful Soup to extract data from websites. Ethical scraping practices. <strong>Task</strong>: Scrape product titles from a mock e-commerce page.</p>", video_url: "" },
        { title: "API Development", content: "<p>Introduction to Flask/Django frameworks. Building a simple REST API endpoint. <strong>Task</strong>: Create a '/hello' endpoint using Flask. 🚀</p>", video_url: "" },
        { title: "Testing", content: "<p>Unit testing with Python's built-in <code>unittest</code> module. Test-Driven Development (TDD) concepts. <strong>Task</strong>: Write tests for a calculator class.</p>", video_url: "" },
        { title: "Real-world Projects", content: "<p>Applying all knowledge to create a final, deployable Python script or application. <strong>Task</strong>: Submit your portfolio project. ✅</p>", video_url: "" },
      ]
    }, {
      id: "graphic_design",
      title: "Graphic Design Fundamentals",
      description: "Learn Adobe Creative Suite and design principles",
      duration: "10 days",
      level: "Beginner",
      icon: "🖌️",
      category: "design",
      rating: 4.6,
      students: 2145,
      curriculum: [
        { title: "Design Principles", content: "<p>Hierarchy, balance, proximity, and repetition. Gestalt principles. <strong>Task</strong>: Analyze a professional poster for its use of hierarchy.</p>", video_url: "" },
        { title: "Color Theory", content: "<p>CMYK vs. RGB, monochromatic, complementary, and analogous color schemes. <strong>Task</strong>: Design a logo using a complementary color scheme of <strong>Emerald Green</strong> and <strong>Ruby Red</strong>.</p>", video_url: "" },
        { title: "Typography", content: "<p>Serif vs. Sans-serif, kerning, tracking, and leading. Font pairing best practices. <strong>Task</strong>: Choose and justify a typeface for a modern tech company.</p>", video_url: "" },
        { title: "Adobe Photoshop", content: "<p>Layers, masks, retouching, and non-destructive editing. <strong>Task</strong>: Retouch a sample portrait photo.</p>", video_url: "" },
        { title: "Adobe Illustrator", content: "<p>Vector vs. raster graphics. Paths, anchor points, and the Pen Tool. <strong>Task</strong>: Recreate a simple icon using the Pen Tool.</p>", video_url: "" },
        { title: "Logo Design", content: "<p>The logo design process, from sketching to final vectorization. Logo styles. <strong>Task</strong>: Design three variations of a logo concept.</p>", video_url: "" },
        { title: "Brand Identity", content: "<p>Visual identity, brand voice, and mood boards. <strong>Task</strong>: Create a mini-brand style guide for a fictional cafe.</p>", video_url: "" },
        { title: "Print Design", content: "<p>DPI, bleed, trim, and safe zones. Preparing files for commercial printing. <strong>Task</strong>: Design a business card with correct print settings.</p>", video_url: "" },
        { title: "Digital Design", content: "<p>Designing for web and mobile. Resolution independence. <strong>Task</strong>: Design a simple social media ad banner.</p>", video_url: "" },
        { title: "Portfolio Creation", content: "<p>Curating your best work and presenting your design rationale. <strong>Task</strong>: Finalize two case studies for your portfolio. ✅</p>", video_url: "" },
      ]
    }, {
      id: "business_ana",
      title: "Business Analytics",
      description: "Data-driven decision making for business growth",
      duration: "10 days",
      level: "Intermediate",
      icon: "📊",
      category: "business",
      rating: 4.7,
      students: 1432,
      curriculum: [
        { title: "Business Intelligence", content: "<p>The BI lifecycle, data warehousing, and ETL processes. <strong>Task</strong>: Map out a simple data flow diagram from source to report.</p>", video_url: "" },
        { title: "Excel Advanced", content: "<p>Pivot tables, advanced formulas (VLOOKUP, INDEX/MATCH), and macro recording. <strong>Task</strong>: Build a dynamic dashboard using a pivot table.</p>", video_url: "" },
        { title: "SQL for Business", content: "<p>SELECT, JOIN, GROUP BY, and aggregate functions. Relational database concepts. <strong>Task</strong>: Write a SQL query to find the top 5 customers by sales revenue.</p>", video_url: "" },
        { title: "Tableau Visualization", content: "<p>Connecting data sources, creating charts, and building interactive dashboards. <strong>Task</strong>: Create a time-series line chart and a scatter plot in Tableau (mock exercise).</p>", video_url: "" },
        { title: "KPI Development", content: "<p>Defining Key Performance Indicators (KPIs). Leading vs. lagging indicators. <strong>Task</strong>: Define 5 KPIs for a SaaS subscription business. 📈</p>", video_url: "" },
        { title: "Forecasting", content: "<p>Time series analysis, moving averages, and simple linear regression for forecasting. <strong>Task</strong>: Forecast next quarter's sales using a 3-period moving average.</p>", video_url: "" },
        { title: "A/B Testing", content: "<p>Designing, executing, and analyzing split tests for optimal results. Statistical significance. <strong>Task</strong>: Determine if a 5% increase in conversion is significant given sample size.</p>", video_url: "" },
        { title: "Customer Analytics", content: "<p>Customer lifetime value (CLV), churn prediction, and segmentation. RFM analysis. <strong>Task</strong>: Segment customers using RFM analysis.</p>", video_url: "" },
        { title: "Financial Modeling", content: "<p>Building basic financial statements and projection models (mock exercise). <strong>Task</strong>: Calculate Net Present Value (NPV) for a new investment.</p>", video_url: "" },
        { title: "Strategic Planning", content: "<p>Translating data insights into actionable business strategies and recommendations. <strong>Task</strong>: Present a final data-driven strategic recommendation. ✅</p>", video_url: "" },
      ]
    }, {
      id: "devops",
      title: "DevOps Engineering",
      description: "Master CI/CD, containerization, and infrastructure automation",
      duration: "10 days",
      level: "Advanced",
      icon: "⚙️",
      category: "programming",
      rating: 4.8,
      students: 987,
      curriculum: [
        { title: "DevOps Culture", content: "<p>The philosophy of DevOps. CALMS framework (Culture, Automation, Lean, Measurement, Sharing). <strong>Task</strong>: Compare the roles of a Developer vs. an Operations Engineer.</p>", video_url: "" },
        { title: "Git & Version Control", content: "<p>Advanced branching strategies (Gitflow, Trunk-based). Resolving complex merges. <strong>Task</strong>: Perform a rebase and a squash merge on a sample repository.</p>", video_url: "" },
        { title: "Docker Containers", content: "<p>Dockerfiles, images, and container orchestration basics. <strong>Task</strong>: Create a Dockerfile for a Python web application and build the image.</p>", video_url: "" },
        { title: "Kubernetes", content: "<p>Pods, Deployments, Services, and Namespaces. Cluster architecture overview. <strong>Task</strong>: Deploy a simple application to a mock Kubernetes cluster.</p>", video_url: "" },
        { title: "CI/CD Pipelines", content: "<p>Continuous Integration and Continuous Delivery concepts. Jenkins/GitHub Actions intro. <strong>Task</strong>: Define a YAML pipeline to automate build and test stages.</p>", video_url: "" },
        { title: "Infrastructure as Code", content: "<p>IaC using Terraform or Ansible. State management. <strong>Task</strong>: Write a basic Terraform configuration to provision a virtual machine.</p>", video_url: "" },
        { title: "Monitoring & Logging", content: "<p>Using Prometheus/Grafana for monitoring and ELK/Splunk for centralized logging. <strong>Task</strong>: Create a dashboard to track application latency.</p>", video_url: "" },
        { title: "Security Integration", content: "<p>DevSecOps principles. Security scanning in the CI/CD pipeline. <strong>Task</strong>: Integrate a static code analysis tool into the build process.</p>", video_url: "" },
        { title: "Cloud Platforms", content: "<p>Comparing deployment strategies on AWS, Azure, and Google Cloud. Cost optimization. <strong>Task</strong>: Identify a cost-saving strategy for a given cloud infrastructure.</p>", video_url: "" },
        { title: "Automation", content: "<p>Scripting complex tasks using Bash or Python. <strong>Task</strong>: Final project: Create a complete CI/CD pipeline from code commit to production deployment. ✅</p>", video_url: "" },
      ]
    }, {
      id: "content_create",
      title: "Content Creation & Video Editing",
      description: "Create engaging content for social media and marketing",
      duration: "10 days",
      level: "Beginner",
      icon: "🎬",
      category: "design",
      rating: 4.5,
      students: 1890,
      curriculum: [
        { title: "Storyboarding", content: "<p>Developing a visual narrative. From script to screen outline. <strong>Task</strong>: Create a 6-panel storyboard for a 30-second promo video.</p>", video_url: "" },
        { title: "Video Shooting Basics", content: "<p>Rule of thirds, lighting, and audio quality. Using smartphone cameras effectively. <strong>Task</strong>: Film a 1-minute segment demonstrating proper lighting setup.</p>", video_url: "" },
        { title: "Adobe Premiere Pro", content: "<p>Interface, basic cuts, transitions, and multi-track editing. <strong>Task</strong>: Edit a short interview using J-cuts and L-cuts.</p>", video_url: "" },
        { title: "Color Grading", content: "<p>Color correction, LUTs, and establishing mood with color. <strong>Task</strong>: Apply a 'cinematic' grade using Lumetri Color panel.</p>", video_url: "" },
        { title: "Sound Design", content: "<p>Mixing audio tracks, adding music, and noise reduction. Royalty-free audio resources. <strong>Task</strong>: Mix dialogue, music, and sound effects for a short scene.</p>", video_url: "" },
        { title: "Motion Graphics", content: "<p>Basic text animation and lower thirds using Adobe After Effects (or similar tools). <strong>Task</strong>: Create a simple animated logo reveal.</p>", video_url: "" },
        { title: "YouTube Optimization", content: "<p>Titles, thumbnails, tags, and end screens for maximizing views. <strong>Task</strong>: Design a compelling, click-worthy thumbnail graphic.</p>", video_url: "" },
        { title: "Social Media Formats", content: "<p>Creating content for TikTok, Reels, and YouTube Shorts (vertical video). Aspect ratios. <strong>Task</strong>: Repurpose a 16:9 video into a 9:16 vertical format.</p>", video_url: "" },
        { title: "Content Strategy", content: "<p>Developing a content calendar and defining KPIs for video performance. <strong>Task</strong>: Outline a viral strategy for a product launch.</p>", video_url: "" },
        { title: "Final Project", content: "<p>Produce and edit a complete 2-3 minute video for a client or portfolio. <strong>Task</strong>: Submit your final edited video file. ✅</p>", video_url: "" },
      ]
    },];

    const firebaseConfig = {
      apiKey: "AIzaSyBnQ0s1jFoMH6J7vhKVM7NVC-WNScLdA7E",
      authDomain: "sutherland-6ce2b.firebaseapp.com",
      databaseURL: "https://sutherland-6ce2b-default-rtdb.firebaseio.com",
      projectId: "sutherland-6ce2b",
      storageBucket: "sutherland-6ce2b.firebasestorage.app",
      messagingSenderId: "243800407888",
      appId: "1:243800407888:web:2c4dfa1e6a267ba2a17655",
      measurementId: "G-S6GMQ32JJ5"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const database = firebase.database();
    // Initialize Firebase Storage (kept but not used for large video files)
    const storage = firebase.storage();

    // Data Storage
    let users = [];
    let certificates = [];
    let globalNotification = null;
    let currentUserId = null;


    // --- UI Helpers ---
    function hideAllScreens() {
      // Added 'my-account-screen' and 'notification-modal' to hide list
      ['welcome-screen', 'login-form', 'register-form', 'dashboard-screen', 'course-list', 'course-detail', 'course-learning', 'profile-screen', 'certificate-screen', 'certificates-screen', 'admin-dashboard-panel', 'admin-login-screen', 'admin-user-details-modal', 'admin-course-manager-panel', 'my-account-screen', 'notification-modal'].forEach(id => {
        const element = document.getElementById(id);
        if (element) element.style.display = 'none';
      });
    }

    function updateNav(isLoggedIn, isAdmin) {
      const navButtons = document.getElementById('nav-buttons');
      const userNav = document.getElementById('user-nav');
      const adminNav = document.getElementById('admin-nav');

      navButtons.style.display = 'none';
      userNav.style.display = 'none';
      adminNav.style.display = 'none';

      if (isAdmin) {
        adminNav.style.display = 'flex';
      } else if (isLoggedIn) {
        if (currentUser) {
          document.getElementById('user-name-nav').textContent = currentUser.name.split(' ')[0];
          document.getElementById('user-avatar').textContent = currentUser.name.charAt(0);
          // Update notification badge on every navigation update
          updateNotificationBadge();
        }
        userNav.style.display = 'flex';
      } else {
        navButtons.style.display = 'flex';
      }
    }

    // --- Screen Navigation Functions ---

    function showWelcomeScreen() {
      hideAllScreens();
      isAdminLoggedIn = false;
      updateNav(false, false);
      document.getElementById('welcome-screen').style.display = 'block';
    }
    function showLogin() { hideAllScreens(); document.getElementById('login-form').style.display = 'block'; }
    function showRegister() { hideAllScreens(); document.getElementById('register-form').style.display = 'block'; }
    function showCourseList() { hideAllScreens(); document.getElementById('course-list').style.display = 'block'; renderCourseList(courses); resetFilterButtons('all'); }
    async function showDashboard() {
      // FIX: Ensure latest data is fetched before showing dashboard
      if (!currentUserId) return showLogin();
      await fetchUserData(); // RELOAD DATA

      // Update last_active timestamp on navigating to Dashboard
      if (currentUserId) {
        database.ref(`edupro_users/${currentUserId}/last_active`).set(Date.now());
      }

      hideAllScreens();
      document.getElementById('dashboard-screen').style.display = 'block';
      renderDashboard();
    }
    async function showCertificates() {
      // FIX: Ensure certificates are latest before rendering
      if (!currentUserId) return showLogin();
      await fetchUserData(); // RELOAD DATA

      hideAllScreens();
      document.getElementById('certificates-screen').style.display = 'block';
      renderCertificates();
    }
    function showProfile() {
      // FIX: Ensure courses are latest before rendering
      if (!currentUserId) return showLogin();
      fetchUserData().then(() => { // RELOAD DATA
        hideAllScreens();
        document.getElementById('profile-screen').style.display = 'block';
        renderProfileCourses();
      });
    }
    function showAdminLogin() { hideAllScreens(); document.getElementById('admin-login-screen').style.display = 'block'; }

    // FIX: Show My Account Screen - Must fetch latest user details
    async function showMyAccount() {
      if (!currentUserId) return showLogin();
      await fetchUserData(); // RELOAD DATA

      hideAllScreens();
      document.getElementById('my-account-screen').style.display = 'block';
      renderMyAccount();
    }

    function showCertificateScreen(certData) {
      hideAllScreens();
      document.getElementById('certificate-screen').style.display = 'block';
      renderCertificate(certData);
    }

    // NEW: Global Notification Popup logic
    async function showNotificationPopup() {
      if (!currentUserId || !currentUser) return showLogin();
      const modal = document.getElementById('notification-modal');
      const content = document.getElementById('notification-content');
      const timestampDisplay = document.getElementById('notification-timestamp');

      await fetchUserData(); // Ensure latest notification data

      if (globalNotification && globalNotification.message) {
        content.innerHTML = `<p class="font-medium text-lg">${globalNotification.message}</p>`;
        timestampDisplay.textContent = new Date(globalNotification.timestamp).toLocaleString();
      } else {
        content.innerHTML = `<p class="font-medium text-lg">No active announcements.</p>`;
        timestampDisplay.textContent = 'N/A';
      }

      // Mark notification as seen
      if (globalNotification && globalNotification.timestamp) {
        await database.ref(`edupro_users/${currentUserId}/last_notification_check`).set(globalNotification.timestamp);
        currentUser.last_notification_check = globalNotification.timestamp;
        updateNotificationBadge();
      }

      modal.style.display = 'flex';
    }

    function closeNotificationPopup() {
      document.getElementById('notification-modal').style.display = 'none';
    }

    // NEW: Logic to update the unread notification badge
    function updateNotificationBadge() {
      const badge = document.getElementById('notification-badge');

      if (!currentUser || !globalNotification || !globalNotification.timestamp) {
        badge.classList.add('hidden');
        return;
      }

      const lastCheck = currentUser.last_notification_check || 0;

      if (globalNotification.timestamp > lastCheck) {
        badge.textContent = 'New!';
        badge.classList.remove('hidden');
      } else {
        badge.classList.add('hidden');
      }
    }

    // NEW: Course Manager Navigation
    function showCourseManagerPanel() {
      if (!isAdminLoggedIn) return showAdminLogin();
      hideAllScreens();
      document.getElementById('admin-course-manager-panel').style.display = 'block';
      renderCourseManagerPanel();
    }

    async function showAdminDashboard() {
      if (!isAdminLoggedIn) return showAdminLogin();
      currentPage = 1; // Reset page when opening dashboard
      hideAllScreens();
      document.getElementById('admin-dashboard-panel').style.display = 'block';
      await fetchUserData(); // Ensure latest data before rendering
      renderAdminDashboard();
    }

    function startLearning(courseId) {
      if (!currentUserId || !currentUser) return showLogin();
      // Update last_active timestamp
      database.ref(`edupro_users/${currentUserId}/last_active`).set(Date.now());

      const course = courses.find(c => c.id === courseId);
      const userEnrollment = currentUser.enrolled_courses ? currentUser.enrolled_courses[courseId] : null;

      // Check if user is actively enrolled (unlocked: status === true)
      if (!userEnrollment || userEnrollment.status !== true) {
        alert("Course not yet unlocked. Please check your payment status on the 'My Courses' page. Status must be ACTIVE (True) for access.");
        showCourseDetail(courseId);
        return;
      }

      hideAllScreens();
      document.getElementById('course-learning').style.display = 'block';
      currentCourse = course;
      // IMPORTANT: If starting, ensure day is reset to 1 if coming from 100% completion before certification was issued
      const currentDayState = userEnrollment.day || 1;
      currentDay = currentDayState;
      renderCourseContent();
    }

    // NEW: Pagination handler
    function handlePagination(direction) {
      if (direction === 'next') {
        currentPage++;
      } else if (direction === 'prev' && currentPage > 1) {
        currentPage--;
      }
      renderAdminStudentTable();
    }

    // --- Core Application Logic ---

    function initializeUI() {
      // CRITICAL FIX: Fetch initial course data immediately on load
      fetchUserData(true).then(() => {
        auth.onAuthStateChanged((user) => {
          if (user) {
            if (user.email === ADMIN_EMAIL && user.uid === 'admin-mock-uid') {
              // Admin logic handled by local flag
            } else {
              currentUserId = user.uid;
              // Fetch all data including notifications
              fetchUserData().then(() => {
                updateNav(true, false);
                if (document.getElementById('welcome-screen').style.display !== 'none' ||
                  document.getElementById('login-form').style.display !== 'none' ||
                  document.getElementById('register-form').style.display !== 'none'
                ) {
                  // Only show dashboard if user is not in the middle of course/cert view
                  if (document.getElementById('course-learning').style.display === 'none' &&
                    document.getElementById('certificate-screen').style.display === 'none') {
                    showDashboard();
                  }
                }
              });
            }
          } else {
            currentUserId = null;
            currentUser = null;
            updateNav(false, isAdminLoggedIn);
            if (!isAdminLoggedIn) {
              if (document.getElementById('dashboard-screen').style.display === 'block' ||
                document.getElementById('profile-screen').style.display === 'block' ||
                document.getElementById('certificates-screen').style.display === 'block' ||
                document.getElementById('course-learning').style.display === 'block' ||
                document.getElementById('my-account-screen').style.display === 'block'
              ) {
                showWelcomeScreen();
              }
            }
          }
        });

        loadPopularCourses();
      });
    }

    // CRITICAL FIX: Added loadCoursesData flag to separate initial course load from user data load
    async function fetchUserData(loadCoursesData = false) {
      try {
        if (loadCoursesData) {
          const courseSnapshot = await database.ref('edupro_courses').once('value');
          const dbCourses = courseSnapshot.val();

          if (dbCourses && Array.isArray(dbCourses) && dbCourses.length > 0) {
            // Overwrite the local sample array with persistent data
            courses = dbCourses;
            loadPopularCourses(); // Refresh welcome screen previews if courses loaded
          }
        }

        // Continue fetching user-specific data
        const userSnapshot = await database.ref('edupro_users').once('value');
        users = userSnapshot.val() ? Object.keys(userSnapshot.val()).map(uid => ({
          uid,
          ...userSnapshot.val()[uid]
        })) : [];
        currentUser = users.find(u => u.uid === currentUserId);

        const certificateSnapshot = await database.ref('certificates').once('value');
        certificates = certificateSnapshot.val() ? Object.values(certificateSnapshot.val()) : [];

        // NEW: Fetch Global Notification
        const notificationSnapshot = await database.ref('edupro_notifications').once('value');
        const rawNotification = notificationSnapshot.val();

        // Clear old notifications (after 10 days - 864,000,000 milliseconds)
        const tenDaysAgo = Date.now() - (10 * 24 * 60 * 60 * 1000);
        if (rawNotification && rawNotification.timestamp < tenDaysAgo) {
          // Clear the notification in Firebase
          await database.ref('edupro_notifications').remove();
          globalNotification = null;
          document.getElementById('current-global-notification').textContent = 'None (Cleared)';
        } else {
          globalNotification = rawNotification;
          if (globalNotification) {
            document.getElementById('current-global-notification').textContent = globalNotification.message;
          }
        }

      } catch (error) {
        console.error("Error fetching data:", error);
        // Keep local data in case of failure, but log error
      }
    }

    // --- Auth & DB Handlers ---

    async function handleAdminLogin(event) {
      event.preventDefault();
      const email = document.getElementById('admin-email').value;
      const password = document.getElementById('admin-password').value;

      if (email === ADMIN_EMAIL && password === ADMIN_PASSWORD) {
        isAdminLoggedIn = true;
        updateNav(false, true);
        showAdminDashboard();
      } else {
        alert("Invalid Admin Credentials.");
      }
    }

    function adminLogout() {
      isAdminLoggedIn = false;
      updateNav(false, false);
      showWelcomeScreen();
    }

    async function handleLogin(event) {
      event.preventDefault();
      const email = document.getElementById('login-email').value;
      const password = document.getElementById('login-password').value;

      try {
        // Check disabled status before signing in
        await fetchUserData();
        const userToLogin = users.find(u => u.email === email);

        if (userToLogin && userToLogin.disabled === true) {
          alert("Account is temporarily disabled by the administrator. Please contact support.");
          return;
        }

        const userCredential = await auth.signInWithEmailAndPassword(email, password);
        // Update last_active timestamp on successful login
        if (userCredential.user.uid) {
          database.ref(`edupro_users/${userCredential.user.uid}/last_active`).set(Date.now());
        }
      } catch (error) {
        alert(`Login Failed: ${error.message}`);
      }
    }

    async function handleRegister(event) {
      event.preventDefault();
      const name = document.getElementById('register-name').value;
      const email = document.getElementById('register-email').value;
      const phone = document.getElementById('register-phone').value;
      const password = document.getElementById('register-password').value;

      try {
        // Name warning alert
        const nameWarning = `
                    ⚠️ WARNING ⚠️
                    The name provided ("${name}") will be used EXCLUSIVELY for your official certificate.
                    It cannot be changed later. 
                    
                    Click OK to confirm your name and continue registration.
                `;
        if (!window.confirm || !window.confirm(nameWarning)) {
          alert(nameWarning + "\nRegistration CANCELLED.");
          return;
        }


        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
        const uid = userCredential.user.uid;

        await database.ref('edupro_users/' + uid).set({
          name: name,
          email: email,
          phone: phone,
          joined: new Date().toISOString().split('T')[0],
          disabled: false,
          last_active: Date.now(),
          last_notification_check: 0 // NEW: for notification tracking
        });

      } catch (error) {
        alert(`Registration Failed: ${error.message}`);
      }
    }

    function logout() {
      // Update last_active on logout
      if (currentUserId) {
        database.ref(`edupro_users/${currentUserId}/last_active`).set(Date.now());
      }
      auth.signOut();
      showWelcomeScreen();
    }


    async function initiatePayment(courseId) {
      if (!currentUserId) return showLogin();
      if (!currentUser) await fetchUserData();

      const course = courses.find(c => c.id === courseId);
      const userEnrollment = currentUser.enrolled_courses ? currentUser.enrolled_courses[courseId] : null;

      if (userEnrollment && userEnrollment.status === true) {
        alert(`You are already enrolled and the ${course.title} course is ACTIVE!`);
        return;
      }

      if (userEnrollment && userEnrollment.status === false) {
        // Already pending, just redirect to payment and remind them.
        window.open(PAYMENT_LINK, '_blank');
        alert("Your enrollment is already PENDING confirmation. Redirecting to payment portal again.");
        return;
      }

      try {
        // 1. Mark enrollment as PENDING (status: false) with day 1
        await database.ref(`edupro_users/${currentUserId}/enrolled_courses/${courseId}/day`).set(1);
        await database.ref(`edupro_users/${currentUserId}/enrolled_courses/${courseId}/status`).set(false);


        // 2. Refresh local data and update UI (important after enrollment)
        await fetchUserData();
        currentUser = users.find(u => u.uid === currentUserId);
        showCourseDetail(courseId); // Update the button/status message

        // 3. Redirect user to payment link in a new tab
        window.open(PAYMENT_LINK, '_blank');

        alert(`Payment initiated for ${course.title}. Your enrollment is PENDING confirmation. Please allow time for admin approval.`);

      } catch (error) {
        alert(`Failed to initiate enrollment: ${error.message}`);
      }
    }

    async function advanceDay(courseId) {
      if (!currentUserId || !currentUser) return showLogin();

      const course = courses.find(c => c.id === courseId);
      const userEnrollment = currentUser.enrolled_courses ? currentUser.enrolled_courses[courseId] : null;

      // Must be UNLOCKED (status: true)
      if (!userEnrollment || userEnrollment.status !== true) {
        alert("This course is currently locked. Please contact support if you believe this is an error.");
        return;
      }
      // Update last_active timestamp
      database.ref(`edupro_users/${currentUserId}/last_active`).set(Date.now());


      const nextDay = userEnrollment.day + 1;
      const isCompleted = nextDay > course.curriculum.length;

      try {
        if (isCompleted) {
          await database.ref(`edupro_users/${currentUserId}/enrolled_courses/${courseId}/day`).set(course.curriculum.length);

          const certificateId = `${currentUserId}-${courseId}`;
          const certData = {
            id: certificateId,
            userId: currentUserId,
            userName: currentUser.name,
            courseId: courseId,
            courseTitle: course.title,
            date: new Date().toISOString().split('T')[0]
          };
          // Issue Certificate
          await database.ref(`certificates/${certificateId}`).set(certData);

          // CRITICAL FIX: Reload data after course completion/certificate issue
          await fetchUserData();
          currentUser = users.find(u => u.uid === currentUserId);

          showCertificateScreen(certData);
          alert(`Congratulations! You have completed the ${course.title} course and earned a certificate!`);
        } else {
          await database.ref(`edupro_users/${currentUserId}/enrolled_courses/${courseId}/day`).set(nextDay);

          // CRITICAL FIX: Reload data after advancing a day
          await fetchUserData();
          currentUser = users.find(u => u.uid === currentUserId);

          currentCourse = courses.find(c => c.id === courseId); // Re-fetch currentCourse to get latest video URL
          currentDay = nextDay;
          renderCourseContent();
        }

        // Ensure metrics are updated after any progress change
        renderDashboard();

      } catch (error) {
        console.error("Error advancing day:", error);
        alert(`Failed to update progress: ${error.message}`);
      }
    }

    // FIX/UPDATE: Permanent deletion of user data
    async function deleteUserPermanently(userId) {
      if (!isAdminLoggedIn) return;
      const userToDelete = users.find(u => u.uid === userId);
      if (!userToDelete) return;

      if (confirm(`ARE YOU SURE you want to permanently delete ALL data for user: ${userToDelete.name} (${userToDelete.email})? This action cannot be undone and will not be logged out in a real application!`)) {
        try {
          // 1. Delete user profile and enrollments
          await database.ref(`edupro_users/${userId}`).remove();

          // 2. Delete associated certificates (filter locally, delete from DB)
          certificates.filter(c => c.userId === userId).forEach(async (cert) => {
            await database.ref(`certificates/${cert.id}`).remove();
          });

          // 3. Re-fetch data and update UI
          await fetchUserData();
          renderAdminDashboard();
          closeAdminUserDetails();
          alert(`User ${userToDelete.name} and all associated data have been permanently deleted.`);

        } catch (error) {
          console.error("Error deleting user:", error);
          alert(`Failed to delete user: ${error.message}`);
        }
      }
    }

    // FIX/UPDATE: Toggle disable status
    async function toggleUserDisableStatus(userId) {
      if (!isAdminLoggedIn) return;
      const userToToggle = users.find(u => u.uid === userId);
      if (!userToToggle) return;

      const currentDisabledStatus = userToToggle.disabled || false;
      const newDisabledStatus = !currentDisabledStatus;

      try {
        // Update the user's profile with the new disabled status
        await database.ref(`edupro_users/${userId}/disabled`).set(newDisabledStatus);

        await fetchUserData();
        renderAdminDashboard();
        // Update modal view right after the change
        showAdminUserDetails(userId);

        alert(`User ${userToToggle.name}'s account status changed to: ${newDisabledStatus ? 'DISABLED (Cannot Log In)' : 'ENABLED (Can Log In)'}`);

      } catch (error) {
        console.error("Error toggling disable status:", error);
        alert(`Failed to change disable status: ${error.message}`);
      }
    }


    // --- Render Functions (Student / Unchanged) ---
    function renderCourseCard(course) { /* ... unchanged ... */
      const userEnrollment = currentUser && currentUser.enrolled_courses ? currentUser.enrolled_courses[course.id] : null;
      const isEnrolled = userEnrollment && userEnrollment.status === true;
      const isPending = userEnrollment && userEnrollment.status === false;
      const isNotEnrolled = !userEnrollment;

      let cardClasses = 'shadow-lg';
      let buttonText = 'View Details';

      if (currentUser) {
        if (isEnrolled) {
          cardClasses = 'border-4 border-green-500 shadow-xl';
          buttonText = 'View Course';
        } else if (isPending) {
          cardClasses = 'border-4 border-orange-500 shadow-xl';
          buttonText = 'Awaiting Confirmation';
        } else if (isNotEnrolled) {
          buttonText = 'Enroll Now';
        }
      }

      return `
                <div class="card-hover bg-white p-6 rounded-xl ${cardClasses}">
                    <div class="text-3xl mb-3">${course.icon}</div>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">${course.title}</h3>
                    <p class="text-gray-600 mb-4">${course.description}</p>
                    <div class="flex justify-between text-sm text-gray-500 mb-4">
                        <span>Level: ${course.level}</span>
                        <span>Duration: ${course.duration}</span>
                    </div>
                    <div class="flex items-center space-x-1 text-yellow-500 mb-4">
                        ${'★'.repeat(Math.floor(course.rating))}
                        ${course.rating % 1 !== 0 ? '☆' : ''}
                        <span class="text-gray-600 ml-1">(${course.students} enrolled)</span>
                    </div>
                    <button onclick="showCourseDetail('${course.id}')" class="w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 transition-colors">
                        ${buttonText}
                    </button>
                </div>
            `;
    }
    function loadPopularCourses() { /* ... unchanged ... */
      const container = document.getElementById('popular-courses-preview');
      // FIX: Ensure courses array has content before slicing
      const popularCourses = courses.slice(0, 3);
      container.innerHTML = popularCourses.map(renderCourseCard).join('');
    }

    function renderCourseList(filteredCourses) { /* ... unchanged ... */
      const container = document.getElementById('courses-container');
      container.innerHTML = filteredCourses.map(renderCourseCard).join('');
    }

    function filterCourses(category) { /* ... unchanged ... */
      let filtered = courses;
      if (category !== 'all') {
        filtered = courses.filter(course => course.category === category);
      }
      renderCourseList(filtered);
      resetFilterButtons(category);
    }

    function resetFilterButtons(activeCategory) { /* ... unchanged ... */
      document.querySelectorAll('.language-filter').forEach(btn => {
        btn.classList.remove('active');
      });
      const activeBtn = document.querySelector(`.language-filter[onclick="filterCourses('${activeCategory}')"]`);
      if (activeBtn) {
        activeBtn.classList.add('active');
      }
    }
    async function showCourseDetail(courseId) { /* ... unchanged ... */
      const course = courses.find(c => c.id === courseId);
      if (!course) return;

      hideAllScreens();
      document.getElementById('course-detail').style.display = 'block';
      const container = document.getElementById('course-detail-content');
      container.setAttribute('data-course-id', courseId);

      const userEnrollment = currentUser && currentUser.enrolled_courses ? currentUser.enrolled_courses[courseId] : null;
      const isEnrolled = userEnrollment && userEnrollment.status === true;
      const isPending = userEnrollment && userEnrollment.status === false;
      const isNotEnrolled = !currentUser || !userEnrollment;
      const currentDay = userEnrollment ? userEnrollment.day : 1;

      let actionButton;
      let enrollmentMessage;


      if (isEnrolled) {
        actionButton = `<button onclick="startLearning('${course.id}')" class="w-full bg-green-600 text-white py-3 rounded-lg text-lg font-semibold hover:bg-green-700 transition-colors">
                    Continue Learning (Day ${currentDay})
                </button>`;
        enrollmentMessage = `<p class="text-center text-sm text-gray-500 mt-4">You have full, lifetime access to this course.</p>`;

      } else if (isPending) {
        actionButton = `<div class="p-4 bg-orange-100 border border-orange-400 rounded-lg text-orange-800">
                    <p class="font-semibold mb-2">Enrollment is **PENDING** admin confirmation.</p>
                    <p class="text-sm">Please allow time for processing. Your status: <span class="font-bold">LOCKED (FALSE)</span></p>
                </div>`;
        enrollmentMessage = `<p class="text-center text-sm text-gray-500 mt-4">Check My Courses for status updates. <button onclick="window.open(PAYMENT_LINK, '_blank')" class="text-indigo-600 underline">View Payment Portal</button></p>`;

      } else if (isNotEnrolled && currentUser) {
        actionButton = `<button onclick="initiatePayment('${course.id}')" class="w-full bg-indigo-600 text-white py-3 rounded-lg text-lg font-semibold hover:bg-indigo-700 transition-colors shadow-xl">
                    Enroll Now - Pay Now
                </button>`;
        enrollmentMessage = `<p class="text-center text-sm text-gray-500 mt-4">Clicking above initiates enrollment (sets status to FALSE) and opens the payment portal.</p>`;

      } else {
        actionButton = `<button onclick="showLogin()" class="w-full bg-indigo-600 text-white py-3 rounded-lg text-lg font-semibold hover:bg-indigo-700 transition-colors shadow-xl">
                    Sign In to Enroll
                </button>`;
        enrollmentMessage = `<p class="text-center text-sm text-gray-500 mt-4">You must be logged in to enroll in this course.</p>`;
      }


      // Use the correct title for the list display
      const curriculumHTML = course.curriculum.map((item, index) => {
        const day = index + 1;
        // Check if curriculum is rich content or simple string
        const dayTitle = typeof item === 'object' && item.title ? item.title : item;

        const completed = isEnrolled && day < currentDay;
        const current = isEnrolled && day === currentDay;
        const statusIcon = completed ? '✅' : current ? '🔥' : '🔒';
        const statusColor = completed ? 'text-green-600' : current ? 'text-red-500' : 'text-gray-500';
        const isLockedVisual = !isEnrolled || (isEnrolled && day > currentDay);


        return `
                    <li class="p-4 border-b last:border-b-0 flex items-center justify-between ${isLockedVisual ? 'opacity-50' : ''}">
                        <span class="font-medium flex items-center">Day ${day}: ${dayTitle}</span>
                        <span class="${statusColor}">${statusIcon}</span>
                    </li>
                `;
      }).join('');

      const html = `
                <div class="max-w-7xl mx-auto bg-white rounded-2xl shadow-2xl overflow-hidden p-8">
                    <div class="md:flex md:space-x-8">
                        <div class="md:w-2/3">
                            <h2 class="text-5xl font-extrabold text-gray-900 mb-3">${course.icon} ${course.title}</h2>
                            <p class="text-xl text-gray-600 mb-6">${course.description}</p>

                            <div class="flex items-center space-x-6 text-gray-700 mb-8">
                                <span class="flex items-center">
                                    <svg class="w-5 h-5 mr-1 text-indigo-500" fill="currentColor" viewBox="0 0 20 20"><path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a5 5 0 00-5 5c0 1.05.176 2.05.51 3L10 16l4.49-3A5 5 0 0015 10a5 5 0 00-5-5z" clip-rule="evenodd"/></svg>
                                    ${course.level}
                                </span>
                                <span class="flex items-center">
                                    <svg class="w-5 h-5 mr-1 text-indigo-500" fill="currentColor" viewBox="0 0 20 20"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z"/></svg>
                                    ${course.duration}
                                </span>
                                <span class="flex items-center text-yellow-500">
                                    ${'★'.repeat(Math.floor(course.rating))}
                                    <span class="text-gray-600 ml-1">(${course.rating})</span>
                                </span>
                            </div>

                            <h3 class="text-3xl font-bold text-gray-800 mb-4">What you will learn:</h3>
                            <ul class="grid grid-cols-2 gap-4 text-gray-700">
                                ${course.curriculum.slice(0, 6).map(item => {
        const itemTitle = typeof item === 'object' && item.title ? item.title : item;
        return `<li class="flex items-center"><svg class="w-4 h-4 mr-2 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg> ${itemTitle}</li>`;
      }).join('')}
                            </ul>
                        </div>

                        <div class="md:w-1/3 mt-8 md:mt-0">
                            <div class="bg-gray-50 p-6 rounded-xl shadow-inner sticky top-24">
                                <h3 class="text-2xl font-bold text-gray-800 mb-4">Course Access</h3>
                                <p class="text-3xl font-extrabold text-indigo-600 mb-6">Course Fee: FREE*</p>
                                ${actionButton}
                                ${enrollmentMessage}
                            </div>
                        </div>
                    </div>

                    <div class="mt-12 pt-8 border-t border-gray-200">
                        <h3 class="text-3xl font-bold text-gray-800 mb-6">Full Curriculum (${course.curriculum.length} Days)</h3>
                        <ul class="bg-white border rounded-xl shadow-lg divide-y divide-gray-100">
                            ${curriculumHTML}
                        </ul>
                    </div>
                </div>
            `;
      container.innerHTML = html;
    }

    // START: MODIFIED renderCourseContent to safely render rich HTML

    /**
     * Safely renders rich HTML content received from the admin editor.
     * The editor should save HTML that uses <p>, <strong>, <span style="">, <ul>/ol/li.
     * @param {string} rawHtml - The raw HTML content string from the curriculum object.
     * @returns {string} The HTML string.
     */
    function renderContentAsHtml(rawHtml) {
      // NOTE: In a production environment, this function would use a library
      // like DOMPurify to strip malicious scripts and ensure safety.
      // For this mock, we trust the admin input and return the raw HTML.
      return rawHtml;
    }

    function renderCourseContent() {
      const container = document.getElementById('course-content');
      const progressDisplay = document.getElementById('course-progress');
      const totalDays = currentCourse.curriculum.length;

      // Get the current day's content object
      const dayContent = currentCourse.curriculum[currentDay - 1];
      // Handle the fact that curriculum must now be rich objects for this to work
      if (!dayContent || !dayContent.title || !dayContent.content) {
        container.innerHTML = `<h4 class="text-2xl font-bold text-red-500">Error: Day ${currentDay} content is missing or malformed.</h4><p>Please contact an administrator to update the course curriculum using the new editor format.</p>`;
        progressDisplay.textContent = '0%';
        return;
      }

      const contentTitle = dayContent.title;
      const contentBody = dayContent.content;
      const videoUrl = dayContent.video_url || '';

      // APPLY HTML RENDERING HERE
      const styledContentBody = renderContentAsHtml(contentBody);

      const progress = Math.round((currentDay / totalDays) * 100);

      progressDisplay.textContent = `${progress}% (Day ${currentDay} of ${totalDays})`;

      const html = `
                <h3 class="text-4xl font-bold text-gray-800 mb-6">${currentCourse.icon} ${currentCourse.title}</h3>

                <div class="mb-8">
                    <div class="text-sm font-medium text-indigo-600 mb-1">Your Progress</div>
                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                        <div class="progress-bar bg-green-500 h-2.5 rounded-full" style="width: ${progress}%"></div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-xl border-t-4 border-indigo-500 mb-8 shadow-xl content-container">
                    <h4 class="text-3xl font-bold text-indigo-800 mb-3 border-none pt-0">${contentTitle}</h4>
                    
                    ${styledContentBody}

                </div>
                
                ${videoUrl ? `
                    <div class="mb-8 bg-white p-4 rounded-xl shadow-lg">
                        <h5 class="text-xl font-semibold text-gray-800 border-b pb-2 mb-4 flex items-center"><span class="text-red-500 mr-2">▶️</span> Video Lecture</h5>
                        <div class="aspect-w-16 aspect-h-9" style="position:relative; width:100%; height:0; padding-bottom:56.25%;">
                            
                            ${videoUrl.startsWith('http') && videoUrl.includes('youtube.com/embed') ? `
                                <iframe 
                                    src="${videoUrl}" 
                                    frameborder="0" 
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                    allowfullscreen
                                    style="position:absolute; top:0; left:0; width:100%; height:100%;">
                                </iframe>
                            ` : (videoUrl.startsWith('http') || videoUrl.startsWith('https') || videoUrl.includes('/videos/') || videoUrl.startsWith('videos/')) ? `
                                <video controls style="position:absolute; top:0; left:0; width:100%; height:100%;" src="${videoUrl}">
                                    Your browser does not support the video tag. Path attempted: ${videoUrl}
                                </video>
                            ` : `
                                <div style="position:absolute; top:0; left:0; width:100%; height:100%; background-color: #f0f0f0; display: flex; align-items: center; justify-content: center; color: #707070;">
                                    <p class="text-center font-medium">Video URL is set but appears to be an invalid link: 
                                      <span class="font-mono text-sm break-all">${videoUrl}</span>
                                    </p>
                                </div>
                            `}
                            </div>
                    </div>
                ` : ''}

                <div class="space-y-4">
                    <h5 class="text-xl font-semibold text-gray-800 border-b pb-2">Learning Resources (Mock)</h5>
                    <div class="flex items-center p-3 bg-white border rounded-lg hover:bg-gray-50 transition-colors shadow-sm">
                        <span class="text-xl mr-3">📖</span>
                        <a href="#" class="text-indigo-600 hover:underline">Download: Official E-Book for Day ${currentDay}</a>
                    </div>
                    <div class="flex items-center p-3 bg-white border rounded-lg hover:bg-gray-50 transition-colors shadow-sm">
                        <span class="text-xl mr-3">🧪</span>
                        <a href="#" class="text-indigo-600 hover:underline">Practice: Interactive Quiz for Day ${currentDay}</a>
                    </div>
                </div>

                <div class="mt-10">
                    <button onclick="advanceDay('${currentCourse.id}')" class="w-full bg-indigo-600 text-white py-3 rounded-lg text-xl font-semibold hover:bg-indigo-700 transition-colors shadow-xl">
                        ${currentDay < totalDays ? `Mark Day ${currentDay} Complete & Go to Next Day →` : 'Complete Course & Get Certificate 🏆'}
                    </button>
                </div>
            `;
      container.innerHTML = html;
    }
    // END: MODIFIED renderCourseContent

    // FIX: Dashboard Metrics and "Continue Learning" List
    function renderDashboard() {
      if (!currentUser) {
        document.getElementById('dashboard-user-name').textContent = "Guest";
        return;
      }

      document.getElementById('dashboard-user-name').textContent = currentUser.name.split(' ')[0];

      const enrolledCourses = currentUser.enrolled_courses || {};
      const userCertificates = certificates.filter(c => c.userId === currentUserId);

      // Calculate Metrics
      const totalEnrolled = Object.keys(enrolledCourses).length;
      const completedCount = userCertificates.length;

      // Calculate Active Courses (status === true)
      const activeEnrollmentIds = Object.keys(enrolledCourses).filter(id => enrolledCourses[id].status === true);
      const activeCourses = activeEnrollmentIds.map(courseId => {
        const course = courses.find(c => c.id === courseId);
        return course ? { ...course, enrollment: enrolledCourses[courseId] } : null;
      }).filter(c => c !== null);

      // Update Metric Cards
      document.getElementById('enrolled-count').textContent = totalEnrolled;
      document.getElementById('completed-count').textContent = completedCount;
      document.getElementById('certificates-count').textContent = completedCount;

      // Render Continue Learning List
      const continueLearningContainer = document.getElementById('continue-learning');
      continueLearningContainer.innerHTML = '';

      if (activeCourses.length === 0) {
        continueLearningContainer.innerHTML = `<p class="text-gray-500 py-4">You are not actively enrolled in any courses yet. Enroll now or wait for admin approval!</p>`;
        return;
      }

      activeCourses.forEach(course => {
        const enrollment = course.enrollment;
        const totalDays = course.curriculum.length;
        const progressDay = enrollment.day || 1;
        const progress = Math.round((progressDay / totalDays) * 100);
        const isComplete = progress === 100;

        // Skip courses already certified
        if (userCertificates.some(c => c.courseId === course.id)) return;

        // Show continue button for courses that are NOT fully complete or are missing certificates
        continueLearningContainer.innerHTML += `
                    <div class="p-4 border rounded-xl shadow-sm hover:shadow-md transition-shadow cursor-pointer border-indigo-200" onclick="startLearning('${course.id}')">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="font-bold text-gray-900 flex items-center">${course.icon} ${course.title}</h4>
                            <span class="bg-indigo-100 text-indigo-800 text-xs font-medium px-2 py-1 rounded-full">Day ${progressDay} of ${totalDays}</span>
                        </div>
                        <p class="text-sm text-gray-500">Progress: ${progress}%</p>
                        <div class="w-full bg-gray-200 rounded-full h-2 mt-1">
                            <div class="progress-bar bg-green-500 h-2 rounded-full" style="width: ${progress}%"></div>
                        </div>
                    </div>
                `;
      });

      // If all actively enrolled courses are certified, show an encouraging message
      if (continueLearningContainer.innerHTML.trim() === '') {
        continueLearningContainer.innerHTML = `<p class="text-gray-500 py-4">🎉 You've completed all active courses! View your certificates or browse new courses.</p>`;
      }
    }

    function renderMyAccount() {
      const container = document.getElementById('my-account-details-container');
      container.innerHTML = '';

      if (!currentUser) {
        container.innerHTML = `<p class="text-red-500">Error: User data is not available. Please log in again.</p>`;
        return;
      }

      // Helper function for formatted row
      const DetailRow = (label, value) => `
                <div class="detail-row py-3">
                    <span class="text-lg font-medium text-gray-600">${label}:</span>
                    <span class="text-lg font-semibold text-gray-900">${value}</span>
                </div>
            `;

      const userCertificates = certificates.filter(c => c.userId === currentUserId);
      const enrolledCount = Object.keys(currentUser.enrolled_courses || {}).length;
      const completedCount = userCertificates.length;
      const status = currentUser.disabled ? 'Disabled by Admin' : 'Active';

      container.innerHTML = `
                ${DetailRow('Full Name (Certificate Name)', currentUser.name)}
                ${DetailRow('Email Address', currentUser.email)}
                ${DetailRow('Phone Number', currentUser.phone || 'N/A')}
                ${DetailRow('Joined Date', currentUser.joined)}
                <div class="detail-row py-3">
                    <span class="text-lg font-medium text-gray-600">Account Status:</span>
                    <span class="text-lg font-semibold ${currentUser.disabled ? 'text-red-600' : 'text-green-600'}">${status}</span>
                </div>
                ${DetailRow('Total Enrolled Courses', enrolledCount)}
                ${DetailRow('Total Certificates Earned', completedCount)}
            `;
    }


    function renderProfileCourses() { /* ... unchanged ... */
      const container = document.getElementById('enrolled-courses');
      container.innerHTML = '';

      if (!currentUser || !currentUser.enrolled_courses) {
        container.innerHTML = `<p class="text-gray-500 py-8">You are not currently enrolled in any courses. <button onclick="showCourseList()" class="text-indigo-600 hover:underline font-semibold">Browse courses</button> to get started!</p>`;
        return;
      }

      const enrolledCourses = currentUser.enrolled_courses;
      const enrolledCourseIds = Object.keys(enrolledCourses);
      const userCertificates = certificates.filter(c => c.userId === currentUserId);

      // Filter to only show courses that are explicitly enrolled or pending (status true or false)
      const activeEnrollments = enrolledCourseIds.filter(id => enrolledCourses[id].status === true || enrolledCourses[id].status === false);


      if (activeEnrollments.length === 0) {
        container.innerHTML = `<p class="text-gray-500 py-8">You are not currently enrolled in any courses. <button onclick="showCourseList()" class="text-indigo-600 hover:underline font-semibold">Browse courses</button> to get started!</p>`;
        return;
      }

      activeEnrollments.forEach(courseId => {
        const course = courses.find(c => c.id === courseId);
        const enrollment = enrolledCourses[courseId];

        if (course && enrollment) {
          const isEnrolled = enrollment.status === true;
          const isPending = enrollment.status === false;

          let actionButton;
          let statusTag;
          let cardClasses = 'border-t-4';

          if (isEnrolled) {
            const totalDays = course.curriculum.length;
            const progress = Math.round((enrollment.day / totalDays) * 100);
            const isComplete = progress === 100;
            const hasCertificate = userCertificates.some(c => c.courseId === courseId);

            cardClasses += ' border-green-500';
            statusTag = `<span class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded-full">Active</span>`;

            if (isComplete) {
              actionButton = hasCertificate ?
                `<button onclick="showCertificateScreen(certificates.find(c => c.courseId === '${courseId}' && c.userId === currentUserId))" class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700">View Certificate 🏆</button>` :
                `<button onclick="advanceDay('${courseId}')" class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700">Finish & Get Certificate 🎓</button>`;
            } else {
              actionButton = `<button onclick="startLearning('${courseId}')" class="w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700">Continue Learning (Day ${enrollment.day})</button>`;
            }
          } else if (isPending) {
            cardClasses += ' border-orange-500';
            statusTag = `<span class="bg-orange-100 text-orange-800 text-xs font-medium px-2.5 py-0.5 rounded-full">Pending Confirmation</span>`;
            actionButton = `<button onclick="showCourseDetail('${courseId}')" class="w-full bg-orange-600 text-white py-2 rounded-lg hover:bg-orange-700">View Status</button>`;
          }


          container.innerHTML += `
                        <div class="card-hover bg-white p-6 rounded-xl shadow-lg w-full sm:w-80 ${cardClasses}">
                            <div class="flex justify-between items-center mb-2">
                                <div class="text-3xl">${course.icon}</div>
                                ${statusTag}
                            </div>
                            <h3 class="text-xl font-bold text-gray-800 mb-2">${course.title}</h3>
                            <p class="text-sm text-gray-600 mb-4">${course.description}</p>

                            ${isEnrolled ? `
                                <div class="mb-4">
                                    <div class="flex justify-between text-sm font-medium text-gray-700">
                                        <span>Progress:</span>
                                        <span>${Math.round((enrollment.day / course.curriculum.length) * 100)}%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2.5 mt-1">
                                        <div class="progress-bar bg-green-500 h-2.5 rounded-full" style="width: ${Math.round((enrollment.day / course.curriculum.length) * 100)}%"></div>
                                    </div>
                                </div>
                            ` : `<div class="h-10 mb-4"></div>`}

                            ${actionButton}
                        </div>
                    `;
        }
      });
    }
    function renderCertificates() { /* ... unchanged ... */
      const container = document.getElementById('certificates-container');
      container.innerHTML = '';

      const userCertificates = certificates.filter(c => c.userId === currentUserId);

      if (userCertificates.length === 0) {
        container.innerHTML = `<p class="text-gray-500 py-8 text-center w-full">You have not completed any courses yet. Keep learning!</p>`;
        return;
      }

      userCertificates.forEach(cert => {
        const course = courses.find(c => c.id === cert.courseId);
        if (course) {
          container.innerHTML += `
                        <div class="card-hover bg-white p-6 rounded-xl shadow-lg border-t-4 border-yellow-500 text-center">
                            <div class="text-5xl mb-3">🎓</div>
                            <h3 class="text-xl font-bold text-gray-800 mb-1">${course.title}</h3>
                            <p class="text-gray-600 mb-3">Certificate of Completion</p>
                            <p class="text-sm text-gray-500 mb-4">Awarded on: ${cert.date}</p>
                            <button onclick="showCertificateScreen(certificates.find(c => c.id === '${cert.id}'))" class="w-full bg-yellow-500 text-gray-900 py-2 rounded-lg hover:bg-yellow-600 transition-colors font-semibold">
                                View Certificate
                            </button>
                        </div>
                    `;
        }
      });
    }
    function renderCertificate(certData) { /* ... unchanged ... */
      if (!certData) return;

      const course = courses.find(c => c.id === certData.courseId);
      if (!course) return;

      const container = document.getElementById('certificate-content');

      container.innerHTML = `
                <div class="certificate-bg p-12 rounded-lg text-center">
                    <h2 class="text-4xl font-serif font-light mb-4 text-yellow-300">Certificate of Achievement</h2>
                    <p class="text-xl font-light mb-2">This certifies that</p>
                    <h1 class="text-6xl font-extrabold mb-6 text-white certificate-name">${certData.userName}</h1>
                    <p class="text-xl font-light mb-4">has successfully completed the course</p>
                    <h2 class="text-3xl font-bold mb-8 text-yellow-300">${course.title}</h2>
                    <div class="flex justify-around items-center text-lg mt-8">
                        <div>
                            <p class="font-bold text-white">${certData.date}</p>
                            <p class="text-sm text-yellow-300">Date Issued</p>
                        </div>
                        <div>
                            <p class="font-bold text-white">EduPro Academy</p>
                            <p class="text-sm text-yellow-300">Authority</p>
                        </div>
                    </div>
                </div>
            `;
      container.setAttribute('data-course-title', course.title);
      container.setAttribute('data-user-name', certData.userName);
    }
    function downloadCertificate() { /* ... unchanged ... */
      const {
        jsPDF
      } = window.jspdf;
      const doc = new jsPDF({
        orientation: 'landscape',
        unit: 'in',
        format: 'letter'
      });

      const courseTitle = document.getElementById('certificate-content').getAttribute('data-course-title');
      const userName = document.getElementById('certificate-content').getAttribute('data-user-name');
      const certData = certificates.find(c => c.userName === userName && c.courseTitle === courseTitle);
      const date = certData ? certData.date : new Date().toISOString().split('T')[0];

      const pageWidth = doc.internal.pageSize.width;
      const pageHeight = doc.internal.pageSize.height;

      doc.setFillColor(30, 60, 114);
      doc.rect(0, 0, pageWidth, pageHeight, 'F');
      doc.setDrawColor(255, 215, 0);
      doc.setLineWidth(0.2);
      doc.rect(0.2, 0.2, pageWidth - 0.4, pageHeight - 0.4, 'S');
      doc.rect(0.4, 0.4, pageWidth - 0.8, pageHeight - 0.8, 'S');

      doc.setFont('times', 'bold');
      doc.setFontSize(36);
      doc.setTextColor(255, 215, 0);
      doc.text("CERTIFICATE OF ACHIEVEMENT", pageWidth / 2, 1.5, {
        align: 'center'
      });

      doc.setFontSize(14);
      doc.setTextColor(255, 255, 255);
      doc.setFont('times', 'normal');
      doc.text("This certifies that", pageWidth / 2, 2.2, {
        align: 'center'
      });

      doc.setFontSize(50);
      doc.setTextColor(255, 255, 255);
      doc.setFont('cursive');
      doc.text(userName, pageWidth / 2, 3.5, {
        align: 'center'
      });

      doc.setFontSize(18);
      doc.setTextColor(255, 255, 255);
      doc.setFont('times', 'normal');
      doc.text("has successfully completed the course", pageWidth / 2, 4.3, {
        align: 'center'
      });

      doc.setFontSize(28);
      doc.setTextColor(255, 215, 0);
      doc.setFont('times', 'bold');
      doc.text(courseTitle, pageWidth / 2, 5.0, {
        align: 'center'
      });

      doc.setFontSize(12);
      doc.setTextColor(255, 255, 255);
      doc.setFont('times', 'normal');

      doc.line(1.5, 6.5, 3.5, 6.5);
      doc.text("Director Signature (Mock)", 2.5, 6.8, {
        align: 'center'
      });

      doc.line(8.0, 6.5, 10.0, 6.5);
      doc.text(`Date: ${date}`, 9.0, 6.8, {
        align: 'center'
      });

      doc.save(`${userName.replace(/ /g, '_')}_${courseTitle.replace(/ /g, '_')}_Certificate.pdf`);
    }


    // --- ADMIN LOGIC ---
    function getCourseTitle(courseId) {
      const course = courses.find(c => c.id === courseId);
      return course ? course.title : 'Unknown Course';
    }

    function getCourseByTitle(title) {
      return courses.find(c => c.title === title);
    }

    // START: NEW/MODIFIED ADMIN EDITOR FUNCTIONS

    // MODIFIED: Simulates "uploading" by generating a predictable static path.
    async function handleVideoUpload(file, courseId, dayIndex) {
      if (!file) return null;

      // Normalize filename to be URL-safe (this is the key to matching your local files)
      const safeFileName = file.name.replace(/[^a-z0-9.]/gi, '_').toLowerCase();

      // --- CRITICAL FIX: Returns the required local static path ---
      // You MUST ensure your videos are in a folder named 'videos' in the same directory as this HTML file.
      const staticVideoPath = `videos/${safeFileName}`;

      console.log(`[Video Path Set]: Path saved to DB is: ${staticVideoPath}. Ensure file exists locally.`);

      // Simulate a brief processing delay.
      await new Promise(resolve => setTimeout(resolve, 300));

      return staticVideoPath;
      // --- END FIX ---
    }

    function createContentToolbar(targetId) {
      const colorsHtml = RICH_TEXT_OPTIONS.colors.map(color =>
        `<button type="button" class="w-5 h-5 rounded-full shadow-sm hover:ring-2 hover:ring-offset-1" style="background-color: ${color};" onclick="formatDoc('${targetId}', 'foreColor', '${color}')"></button>`
      ).join('');

      const bgColorsHtml = RICH_TEXT_OPTIONS.bgColors.map((color, index) =>
        `<button type="button" class="w-5 h-5 rounded-sm shadow-sm hover:ring-2 hover:ring-offset-1" style="background-color: ${color}; border: 1px solid #ccc;" onclick="formatDoc('${targetId}', 'backColor', '${color}')"></button>`
      ).join('');


      return `
                <div class="flex flex-wrap items-center space-x-2 p-2 bg-gray-50 border-b rounded-t-lg">
                    <div class="relative group">
                        <button type="button" class="p-2 text-gray-700 bg-white rounded-md hover:bg-gray-200 border">🎨 Text Color</button>
                        <div class="absolute z-10 hidden group-hover:block bg-white border p-2 rounded-lg shadow-xl" style="width: 150px;">
                            <div class="flex flex-wrap gap-1">${colorsHtml}</div>
                        </div>
                    </div>

                    <div class="relative group">
                        <button type="button" class="p-2 text-gray-700 bg-white rounded-md hover:bg-gray-200 border">🖌️ BG Color</button>
                        <div class="absolute z-10 hidden group-hover:block bg-white border p-2 rounded-lg shadow-xl" style="width: 150px;">
                            <div class="flex flex-wrap gap-1">${bgColorsHtml}</div>
                        </div>
                    </div>

                    <button type="button" class="p-2 text-gray-700 bg-white rounded-md hover:bg-gray-200 border" onclick="formatDoc('${targetId}', 'bold')"><strong>B</strong></button>
                    <button type="button" class="p-2 text-gray-700 bg-white rounded-md hover:bg-gray-200 border" onclick="formatDoc('${targetId}', 'italic')"><em>I</em></button>
                    <button type="button" class="p-2 text-gray-700 bg-white rounded-md hover:bg-gray-200 border" onclick="formatDoc('${targetId}', 'underline')"><u>U</u></button>

                    <button type="button" class="p-2 text-gray-700 bg-white rounded-md hover:bg-gray-200 border" onclick="formatDoc('${targetId}', 'insertUnorderedList')">• List</button>
                    <button type="button" class="p-2 text-gray-700 bg-white rounded-md hover:bg-gray-200 border" onclick="formatDoc('${targetId}', 'insertOrderedList')">1. List</button>
                    <button type="button" class="p-2 text-gray-700 bg-white rounded-md hover:bg-gray-200 border" onclick="formatDoc('${targetId}', 'formatBlock', '<h4>')">H4</button>
                    <button type="button" class="p-2 text-gray-700 bg-white rounded-md hover:bg-gray-200 border" onclick="formatDoc('${targetId}', 'formatBlock', '<p>')">P</button>

                    <button type="button" class="p-2 text-gray-700 bg-white rounded-md hover:bg-gray-200 border" onclick="insertImage('${targetId}')">🖼️ Image</button>
                </div>
            `;
    }

    function formatDoc(id, command, value = null) {
      document.getElementById(id).focus();
      document.execCommand(command, false, value);
      document.getElementById(id).focus();
    }

    function insertImage(targetId) {
      const url = prompt("Enter the URL for the image:");
      if (url) {
        document.getElementById(targetId).focus();
        document.execCommand('insertImage', false, url);
        document.getElementById(targetId).focus();
      }
    }

    // MODIFIED: Replaced video_url input with a file input
    function addCurriculumModule(module = { title: '', content: '', video_url: '' }) {
      const container = document.getElementById('curriculum-modules-container');
      const dayIndex = container.children.length + 1;
      const contentId = `content-${dayIndex}-${Date.now()}`; // Unique ID for editor
      const videoInputId = `video-file-${dayIndex}-${Date.now()}`;
      const videoUrlInputId = `video-url-hidden-${dayIndex}-${Date.now()}`;

      const newModule = document.createElement('div');
      newModule.className = 'module-block p-4 border border-gray-300 rounded-lg bg-white shadow-sm relative';
      newModule.setAttribute('data-module-index', dayIndex);

      // Determine if a video URL is already set (for edit mode)
      const isVideoSet = module.video_url.trim() !== '';
      let videoPlaceholderText;

      // FIX: Generate descriptive text based on current video_url (which holds the path)
      if (isVideoSet) {
        videoPlaceholderText = module.video_url.includes('youtube')
          ? `Video set (YouTube).`
          : `Current Path: ${module.video_url}`;
      } else {
        videoPlaceholderText = 'No video file selected.';
      }


      newModule.innerHTML = `
                <div class="flex justify-between items-center mb-3 border-b pb-2">
                    <h5 class="text-lg font-bold text-gray-800">Day ${dayIndex} / Module ${dayIndex}</h5>
                    <button type="button" onclick="removeCurriculumModule(this)" class="text-red-500 hover:text-red-700">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>

                <div class="mb-3">
                    <label class="block text-sm font-medium text-gray-700">Day Title (e.g., 'HTML Fundamentals')</label>
                    <input type="text" value="${module.title}" class="w-full px-3 py-2 border rounded-lg day-title-input" required>
                </div>
                
                <div class="mb-3 border border-red-300 p-3 rounded-lg bg-red-50">
                    <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        <span class="mr-2 text-red-500">🎬</span> Video File Selection (Select the file from your local videos folder)
                    </label>
                    <input type="file" id="${videoInputId}" accept="video/mp4,video/quicktime,video/webm" class="day-video-file-input block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100">
                    <p class="text-xs text-gray-500 mt-2">Status: <span id="video-status-${videoInputId}" class="font-semibold">${videoPlaceholderText}</span></p>
<p class="text-xs text-red-700 font-semibold mt-1">CRITICAL: The file will NOT be uploaded. Its path is saved as a static link. You MUST manually ensure the file exists at.</p>
                    <input type="hidden" id="${videoUrlInputId}" value="${module.video_url}" class="day-video-url-input">
                </div>
                <div class="mb-3">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Body Content</label>
                    ${createContentToolbar(contentId)}
                    <div id="${contentId}" 
                         contenteditable="true" 
                         class="content-editor p-3 border-t-0 rounded-b-lg bg-gray-50 focus:bg-white transition-colors" 
                         required>
                         ${module.content}
                    </div>
                </div>
            `;

      container.appendChild(newModule);

      // Add event listener to update status text on file selection
      document.getElementById(videoInputId).addEventListener('change', (event) => {
        const file = event.target.files[0];
        const statusElement = document.getElementById(`video-status-${videoInputId}`);
        const urlInputE = document.getElementById(videoUrlInputId);

        if (file) {
          // Update status with selected file name
          statusElement.textContent = `Selected: ${file.name}. This file's path will be saved on Course Update.`;
          // Clear existing URL to signal that a new path must be generated and saved on form submit
          urlInputE.value = '';
        } else {
          // If file input is cleared, keep the existing path/URL
          urlInputE.value = module.video_url;
          statusElement.textContent = isVideoSet
            ? `Current Path: ${module.video_url}`
            : 'No video file selected.';
        }
      });
    }

    function removeCurriculumModule(buttonElement) {
      const moduleBlock = buttonElement.closest('.module-block');
      moduleBlock.remove();

      // Re-index modules after deletion
      const container = document.getElementById('curriculum-modules-container');
      Array.from(container.children).forEach((child, index) => {
        const dayIndex = index + 1;
        child.setAttribute('data-module-index', dayIndex);
        child.querySelector('h5').textContent = `Day ${dayIndex} / Module ${dayIndex}`;
      });
    }

    function renderCourseManagerPanel() {
      const tableBody = document.getElementById('course-manager-table-body');
      tableBody.innerHTML = '';
      resetCourseForm();
      // We intentionally skip re-adding addCurriculumModule() here as resetCourseForm() handles it

      courses.forEach(course => {
        const dayCount = Array.isArray(course.curriculum) ? course.curriculum.length : 'N/A';
        const row = `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${course.icon} ${course.title}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${course.id}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${dayCount}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm space-x-2">
                            <button onclick="editCourse('${course.id}')" class="text-indigo-600 hover:text-indigo-900 font-medium">Edit</button>
                            <button onclick="deleteCourse('${course.id}')" class="text-red-600 hover:text-red-900 font-medium">Delete</button>
                        </td>
                    </tr>
                `;
        tableBody.innerHTML += row;
      });
    }

    function resetCourseForm() {
      document.getElementById('course-management-form').reset();
      document.getElementById('course-form-title').textContent = 'Add New Course';
      document.getElementById('submit-course-btn').textContent = 'Add Course';
      document.getElementById('course-id').disabled = false;
      document.getElementById('original-course-id').value = '';

      // Clear and re-add one default module
      const container = document.getElementById('curriculum-modules-container');
      container.innerHTML = '';
      addCurriculumModule();
    }

    function editCourse(courseId) {
      const course = courses.find(c => c.id === courseId);
      if (!course) return;

      document.getElementById('course-form-title').textContent = `Edit Course: ${course.title}`;
      document.getElementById('submit-course-btn').textContent = 'Save Changes';

      document.getElementById('course-title').value = course.title;
      document.getElementById('course-id').value = course.id;
      document.getElementById('course-id').disabled = true; // Prevent changing ID
      document.getElementById('course-description').value = course.description;

      document.getElementById('original-course-id').value = course.id;

      // Populate dynamic modules
      const container = document.getElementById('curriculum-modules-container');
      container.innerHTML = '';
      course.curriculum.forEach(module => addCurriculumModule(module));
    }

    // START: MODIFIED handleCourseSubmit to handle file paths
    async function handleCourseSubmit(event) {
      event.preventDefault();
      const submitButton = document.getElementById('submit-course-btn');
      submitButton.disabled = true;
      submitButton.textContent = 'Processing (Saving Paths... Please Wait)';

      const isEdit = document.getElementById('original-course-id').value !== '';
      const courseId = document.getElementById('course-id').value;
      const newTitle = document.getElementById('course-title').value;
      const newDescription = document.getElementById('course-description').value;

      const moduleBlocks = document.querySelectorAll('#curriculum-modules-container .module-block');
      const newCurriculumArray = [];

      if (moduleBlocks.length === 0) {
        alert('Course must have at least one Day/Module defined.');
        submitButton.disabled = false;
        submitButton.textContent = isEdit ? 'Save Changes' : 'Add Course';
        return;
      }

      try {
        for (let index = 0; index < moduleBlocks.length; index++) {
          const block = moduleBlocks[index];
          const dayIndex = index + 1;

          const titleInput = block.querySelector('.day-title-input');
          const contentDiv = block.querySelector('.content-editor');
          const fileInput = block.querySelector('.day-video-file-input');
          const urlInput = block.querySelector('.day-video-url-input');

          if (!titleInput.value) {
            throw new Error(`Day ${dayIndex} is missing a title.`);
          }

          let finalVideoUrl = urlInput.value; // Start with the existing DB value (path)

          // Check for a new file selection (fileInput.files[0] will be present)
          const file = fileInput.files[0];

          // If a file was selected 
          if (file) {
            // Use the new simplified function to generate a static path
            const staticPath = await handleVideoUpload(file, courseId, dayIndex);
            if (staticPath) {
              finalVideoUrl = staticPath;
            } else {
              // This would only happen if the mock function fails.
              throw new Error(`Failed to generate static video path for Day ${dayIndex}.`);
            }
          } else if (urlInput.value === '' && !file) {
            // If both file input and hidden URL are empty, ensure it is explicitly empty string
            finalVideoUrl = '';
          }
          // If no file selected, finalVideoUrl remains the previous DB value (urlInput.value)


          newCurriculumArray.push({
            title: titleInput.value,
            content: contentDiv.innerHTML,
            video_url: finalVideoUrl || "" // Store the final URL/Path
          });
        }
      } catch (error) {
        alert('Course submission failed: ' + error.message);
        submitButton.disabled = false;
        submitButton.textContent = isEdit ? 'Save Changes' : 'Add Course';
        return;
      }

      const newDuration = `${newCurriculumArray.length} days`;
      let success = false;

      if (isEdit) {
        const index = courses.findIndex(c => c.id === courseId);
        if (index !== -1) {
          courses[index].title = newTitle;
          courses[index].description = newDescription;
          courses[index].curriculum = newCurriculumArray;
          courses[index].duration = newDuration;
          success = true;
        }
      } else {
        if (courses.some(c => c.id === courseId)) {
          alert('Course ID must be unique!');
          submitButton.disabled = false;
          submitButton.textContent = isEdit ? 'Save Changes' : 'Add Course';
          return;
        }
        const newCourse = {
          id: courseId,
          title: newTitle,
          description: newDescription,
          duration: newDuration,
          level: "Unspecified",
          icon: "📚",
          category: "general",
          rating: 5.0,
          students: 0,
          curriculum: newCurriculumArray
        };
        courses.push(newCourse);
        success = true;
      }

      if (success) {
        try {
          // FIX: Reload courses after saving to ensure the global 'courses' array
          // and the UI reflects the new video URL immediately.
          await database.ref('edupro_courses').set(courses);
          await fetchUserData(true); // Re-fetch courses from DB

          renderCourseManagerPanel();
          renderCourseList(courses);
          loadPopularCourses(); // Refresh previews immediately
          alert(`Course "${newTitle}" ${isEdit ? 'updated' : 'added'} successfully and SAVED to database!`);
        } catch (error) {
          console.error("Firebase Save Error:", error);
          alert("Error saving course to database. Check console.");
        }
      }

      submitButton.disabled = false;
      submitButton.textContent = isEdit ? 'Save Changes' : 'Add Course';
    }
    // END: MODIFIED handleCourseSubmit

    function deleteCourse(courseId) {
      if (confirm(`Are you sure you want to delete course ID: ${courseId}? This cannot be undone.`)) {
        const index = courses.findIndex(c => c.id === courseId);
        if (index !== -1) {
          courses.splice(index, 1);
          // CRITICAL FIX: Persist deletion to Firebase
          database.ref('edupro_courses').set(courses).then(() => {
            renderCourseManagerPanel();
            renderCourseList(courses);
            loadPopularCourses(); // Refresh previews immediately
            alert('Course deleted and changes saved.');
          }).catch(error => {
            console.error("Firebase Delete Error:", error);
            alert("Error deleting course from database.");
          });
        }
      }
    }

    // NEW: Notification Sender (Updated to update globalNotification display)
    async function sendGlobalNotification(event) {
      event.preventDefault();
      const message = document.getElementById('notification-input').value;
      if (!message) return;

      const notificationData = {
        message: message,
        timestamp: Date.now()
      };

      try {
        // Set the message in the Firebase notifications node
        await database.ref('edupro_notifications').set(notificationData);
        // No need for fetchUserData here as we update locally and the rest of the UI will pick it up on login/navigation
        globalNotification = notificationData;
        alert('Notification broadcasted successfully!');
        document.getElementById('notification-input').value = '';
        document.getElementById('current-global-notification').textContent = message;

      } catch (error) {
        console.error('Error sending notification:', error);
        alert('Failed to send notification.');
      }
    }


    // --- ADMIN DASHBOARD UTILITIES ---

    async function toggleCourseStatus(userId, courseId, currentStatus) {
      if (!isAdminLoggedIn) {
        alert("Authorization failed. Please log in as Admin.");
        return;
      }

      const newStatus = currentStatus === 'false' ? true : false;

      try {
        await database.ref(`edupro_users/${userId}/enrolled_courses/${courseId}/status`).set(newStatus);

        // CRITICAL FIX: Reload all data after changing approval status
        await fetchUserData();
        renderAdminDashboard();

        alert(`Status for ${getCourseTitle(courseId)} for user ${users.find(u => u.uid === userId)?.name} updated to ${newStatus ? 'TRUE (ACTIVE)' : 'FALSE (PENDING)'}`);

      } catch (error) {
        console.error("Error toggling course status:", error);
        alert(`Failed to update status: ${error.message}`);
      }
    }

    // NEW: Function to check if user is online
    function isUserOnline(lastActiveTimestamp) {
      if (!lastActiveTimestamp) return false;
      const fiveMinutesAgo = Date.now() - (5 * 60 * 1000);
      return lastActiveTimestamp > fiveMinutesAgo;
    }

    // NEW: Function to calculate enrollment data for the chart (unchanged)
    function getCourseEnrollmentDistributionData() {
      const enrollmentMap = {};

      courses.forEach(course => {
        enrollmentMap[course.id] = { enrolled: 0, certified: 0, title: course.title };
      });

      let totalApprovals = 0;
      let totalRevokes = 0;
      let totalActiveUsers = 0;

      users.forEach(user => {
        const userEnrollments = user.enrolled_courses || {};

        Object.keys(userEnrollments).forEach(courseId => {
          if (enrollmentMap[courseId]) {
            enrollmentMap[courseId].enrolled++;

            if (userEnrollments[courseId].status === true) {
              totalApprovals++;
            } else {
              totalRevokes++;
            }
          }
        });

        // Active User Logic: Enabled AND has recent activity
        if (!user.disabled && isUserOnline(user.last_active)) {
          totalActiveUsers++;
        }
      });

      certificates.forEach(cert => {
        if (enrollmentMap[cert.courseId]) {
          enrollmentMap[cert.courseId].certified++;
        }
      });

      return {
        labels: Object.values(enrollmentMap).map(d => d.title),
        enrolledData: Object.values(enrollmentMap).map(d => d.enrolled),
        certifiedData: Object.values(enrollmentMap).map(d => d.certified),
        totalApprovals,
        totalRevokes,
        totalActiveUsers
      };
    }

    function renderAdminDashboard() {
      if (!isAdminLoggedIn) return;

      // --- METRICS UPDATE ---
      const distributionData = getCourseEnrollmentDistributionData();

      document.getElementById('metric-total-students').textContent = users.length;
      document.getElementById('metric-total-certificates').textContent = certificates.length;
      document.getElementById('last-updated').textContent = new Date().toLocaleTimeString();

      document.getElementById('metric-total-active-users').textContent = distributionData.totalActiveUsers;
      document.getElementById('metric-approvals').textContent = distributionData.totalApprovals;
      document.getElementById('metric-revokes').textContent = distributionData.totalRevokes;

      // --- GRAPH UPDATE ---
      const ctx = document.getElementById('courseChart').getContext('2d');

      if (courseChartInstance) {
        courseChartInstance.destroy();
      }

      courseChartInstance = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: distributionData.labels,
          datasets: [{
            label: 'Total Enrolled (Active or Pending)',
            data: distributionData.enrolledData,
            backgroundColor: 'rgba(59, 130, 246, 0.7)', // Blue
            borderColor: 'rgba(59, 130, 246, 1)',
            borderWidth: 1
          }, {
            label: 'Certified (Completed)',
            data: distributionData.certifiedData,
            backgroundColor: 'rgba(16, 185, 129, 0.7)', // Green
            borderColor: 'rgba(16, 185, 129, 1)',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: 'Number of Students'
              }
            }
          }
        }
      });

      // --- TABLE RENDER (Including filter setup) ---

      const courseFilter = document.getElementById('admin-course-filter');
      courseFilter.innerHTML = '<option value="all">All Courses</option>';
      courses.forEach(c => {
        const option = document.createElement('option');
        option.value = c.id;
        option.textContent = c.title;
        courseFilter.appendChild(option);
      });

      renderAdminStudentTable();

      document.getElementById('admin-student-search').oninput = renderAdminStudentTable;
      document.getElementById('admin-course-filter').onchange = renderAdminStudentTable;
      document.getElementById('admin-status-filter').onchange = renderAdminStudentTable;
      document.getElementById('admin-online-filter').onchange = renderAdminStudentTable;
    }

    function renderAdminStudentTable() {
      const tableBody = document.getElementById('admin-table-body');
      const noResults = document.getElementById('admin-no-results');
      const nextPageBtn = document.getElementById('next-page-btn');
      const prevPageBtn = document.getElementById('prev-page-btn');
      const paginationInfo = document.getElementById('pagination-info');

      tableBody.innerHTML = '';

      const searchTerm = document.getElementById('admin-student-search').value.toLowerCase();
      const filterCourseId = document.getElementById('admin-course-filter').value;
      const filterStatus = document.getElementById('admin-status-filter').value;
      const filterOnline = document.getElementById('admin-online-filter').value;

      // Flatten data: one row per user-course enrollment
      const allEnrollmentRecords = [];
      users.forEach(user => {
        const userEnrollments = user.enrolled_courses || {};
        Object.keys(userEnrollments).forEach(courseId => {
          allEnrollmentRecords.push({
            userId: user.uid,
            userName: user.name,
            userEmail: user.email,
            userPhone: user.phone || '',
            lastActive: user.last_active,
            joined: user.joined,
            courseId: courseId,
            courseTitle: getCourseTitle(courseId),
            status: userEnrollments[courseId].status // boolean true/false
          });
        });
      });

      const filteredRecords = allEnrollmentRecords.filter(record => {
        // 1. Search (Name, Email, Phone)
        if (searchTerm && !record.userName.toLowerCase().includes(searchTerm) && !record.userEmail.toLowerCase().includes(searchTerm) && !record.userPhone.includes(searchTerm)) {
          return false;
        }
        // 2. Course Filter
        if (filterCourseId !== 'all' && record.courseId !== filterCourseId) {
          return false;
        }
        // 3. Enrollment Status Filter
        if (filterStatus === 'true' && record.status !== true) {
          return false;
        }
        if (filterStatus === 'false' && record.status !== false) {
          return false;
        }
        // 4. Online Status Filter
        const isOnline = isUserOnline(record.lastActive);
        if (filterOnline === 'online' && !isOnline) {
          return false;
        }
        if (filterOnline === 'offline' && isOnline) {
          return false;
        }

        return true;
      });

      // --- PRIORITY & SORTING (Pending FIFO first, sorted by join date) ---

      // 1. Separate pending (false) and active (true) records
      const pendingRecords = filteredRecords.filter(r => r.status === false);
      const activeRecords = filteredRecords.filter(r => r.status === true);

      // 2. FIFO Sorting: Sort by joined date (oldest first - ascending order)
      // Use user.joined which is ISO date string (easier to sort)
      pendingRecords.sort((a, b) => new Date(a.joined) - new Date(b.joined));
      activeRecords.sort((a, b) => new Date(a.joined) - new Date(b.joined));

      // 3. Combine: Pending first (highest priority), then Active
      const finalSortedRecords = pendingRecords.concat(activeRecords);
      const totalRecords = finalSortedRecords.length;

      // --- PAGINATION ---
      const startIndex = (currentPage - 1) * RECORDS_PER_PAGE;
      const endIndex = Math.min(startIndex + RECORDS_PER_PAGE, totalRecords);
      const recordsToDisplay = finalSortedRecords.slice(startIndex, endIndex);

      // Update pagination UI
      paginationInfo.textContent = `Displaying ${totalRecords > 0 ? startIndex + 1 : 0}-${endIndex} of ${totalRecords} records`;
      nextPageBtn.style.display = endIndex < totalRecords ? 'block' : 'none';
      prevPageBtn.style.display = currentPage > 1 ? 'block' : 'none';


      if (recordsToDisplay.length === 0 && totalRecords > 0) {
        // Should not happen unless filters are too strict or pagination logic error, reset page
        currentPage = 1;
        renderAdminStudentTable();
        return;
      } else if (recordsToDisplay.length === 0) {
        noResults.style.display = 'block';
        nextPageBtn.style.display = 'none';
        prevPageBtn.style.display = 'none';
        currentPage = 1;
      } else {
        noResults.style.display = 'none';
        recordsToDisplay.forEach(record => {
          const statusText = record.status ? 'ACTIVE (TRUE)' : 'PENDING (FALSE)';
          const statusClass = record.status ? 'bg-green-100 text-green-800' : 'bg-orange-100 text-orange-800';

          const isOnline = isUserOnline(record.lastActive);
          const onlineStatusTag = isOnline
            ? `<span class="ml-2 px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Online</span>`
            : `<span class="ml-2 px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">Offline</span>`;

          let actionButton;

          if (!record.status) {
            actionButton = `<button onclick="toggleCourseStatus('${record.userId}', '${record.courseId}', 'false')"
                                             class="bg-blue-600 text-white px-4 py-2 rounded-lg text-xs hover:bg-blue-700 transition-colors">
                                             APPROVE
                                           </button>`;
          } else {
            actionButton = `<button onclick="toggleCourseStatus('${record.userId}', '${record.courseId}', 'true')"
                                             class="bg-gray-400 text-white px-4 py-2 rounded-lg text-xs hover:bg-gray-500 transition-colors">
                                             Revoke
                                           </button>`;
          }

          const row = `
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${record.userName} ${onlineStatusTag}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${record.userEmail}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-indigo-600">${record.courseTitle}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm">
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}">
                                    ${statusText}
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm flex space-x-2">
                                ${actionButton}
                                <button onclick="showAdminUserDetails('${record.userId}')"
                                             class="bg-purple-600 text-white px-4 py-2 rounded-lg text-xs hover:bg-purple-700 transition-colors">
                                             Profile
                                </button>
                            </td>
                        </tr>
                    `;
          tableBody.innerHTML += row;
        });
      }
    }


    // **********************************************
    // ******* UPDATED: ADMIN MODAL FUNCTIONS *******
    // **********************************************

    async function showAdminUserDetails(userId) {
      if (!isAdminLoggedIn) return;
      const modal = document.getElementById('admin-user-details-modal');
      const user = users.find(u => u.uid === userId);

      if (!user) {
        alert("User data not found.");
        return;
      }

      modal.style.display = 'flex';
      modal.setAttribute('data-user-id', userId);

      // Fetch user-specific metrics
      const userCertificates = certificates.filter(c => c.userId === userId);
      const enrolledCourses = user.enrolled_courses || {};
      const enrolledCourseIds = Object.keys(enrolledCourses);
      const enrolledCount = enrolledCourseIds.length;
      const completedCount = userCertificates.length;


      // 1. Update User Info (Enhanced Styling)
      document.getElementById('modal-user-name').textContent = user.name;
      const infoContainer = document.getElementById('modal-user-info');

      const disableBtn = document.getElementById('disable-user-btn');
      const currentDisabledStatus = user.disabled || false;
      disableBtn.textContent = currentDisabledStatus ? '✅ ENABLE User' : '🚫 DISABLE User';

      disableBtn.className = `px-4 py-2 rounded-lg text-sm transition-colors flex-1 shadow-md font-semibold ${currentDisabledStatus
        ? 'bg-green-600 hover:bg-green-700 text-white'
        : 'bg-yellow-500 hover:bg-yellow-600 text-gray-900'
        }`;

      // Helper function for formatted row
      const DetailRow = (label, value, colorClass = 'text-gray-900', isMonospace = false) => `
                <div class="detail-row">
                    <span class="text-sm font-medium text-gray-500">${label}:</span>
                    <span class="text-sm font-semibold ${colorClass} ${isMonospace ? 'font-mono text-xs' : ''} break-all">${value}</span>
                </div>
            `;


      infoContainer.innerHTML = `
                ${DetailRow('UID', user.uid, 'text-indigo-700', true)}
                ${DetailRow('Email', user.email)}
                ${DetailRow('Phone', user.phone || 'N/A')}
                ${DetailRow('Joined Date', user.joined)}
                ${DetailRow('Last Active', `${new Date(user.last_active).toLocaleString()} (${isUserOnline(user.last_active) ? 'Online' : 'Offline'})`)}
                ${DetailRow('Enrolled / Certified', `${enrolledCount} / ${completedCount}`, 'text-indigo-600')}
                <div class="p-2 mt-3 rounded-lg text-center font-extrabold ${currentDisabledStatus ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'}">
                    ACCOUNT STATUS: ${currentDisabledStatus ? 'DISABLED (Locked)' : 'ENABLED (Active)'}
                </div>
            `;

      // 2. Update Enrolled Courses (Detailed List)
      const courseListContainer = document.getElementById('modal-course-list');
      courseListContainer.innerHTML = '';

      document.getElementById('modal-enrolled-count').textContent = enrolledCount;

      if (enrolledCourseIds.length === 0) {
        courseListContainer.innerHTML = '<p class="text-gray-500 p-4 text-center bg-gray-100 rounded-lg">No enrollments found for this user.</p>';
      } else {
        enrolledCourseIds.forEach(courseId => {
          const course = courses.find(c => c.id === courseId);
          const enrollment = enrolledCourses[courseId];

          if (course) {
            const isEnrolled = enrollment.status === true;
            const statusColor = isEnrolled ? 'bg-green-500 text-white' : 'bg-orange-500 text-white';
            const statusText = isEnrolled ? 'Active' : 'Pending';
            const progress = Math.round(((enrollment.day || 1) / course.curriculum.length) * 100);
            const isCertified = userCertificates.some(c => c.courseId === courseId);

            // Action button for this specific enrollment
            const enrollmentActionButton = isEnrolled
              ? `<button onclick="toggleCourseStatus('${userId}', '${courseId}', 'true'); showAdminUserDetails('${userId}')" class="bg-gray-400 text-white px-3 py-1 text-xs rounded-lg hover:bg-gray-500 transition-colors shadow-sm font-medium">Revoke</button>`
              : `<button onclick="toggleCourseStatus('${userId}', '${courseId}', 'false'); showAdminUserDetails('${userId}')" class="bg-blue-600 text-white px-3 py-1 text-xs rounded-lg hover:bg-blue-700 transition-colors shadow-sm font-medium">Approve</button>`;

            const certificateButton = isCertified
              ? `<span class="bg-yellow-500 text-gray-900 px-3 py-1 text-xs font-bold rounded-lg ml-2 shadow-sm">Certified 🏆</span>`
              : '';

            courseListContainer.innerHTML += `
                            <div class="course-item-admin border border-indigo-100 p-4 rounded-xl bg-white shadow-sm">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-bold text-indigo-700">${course.icon} ${course.title}</h4>
                                    <span class="px-3 py-1 text-xs font-bold rounded-full ${statusColor}">${statusText}</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="progress-bar bg-indigo-500 h-2 rounded-full" style="width: ${progress}%"></div>
                                </div>
                                <div class="flex justify-between items-center text-xs text-gray-600 mt-2 pt-2 border-t border-gray-100">
                                    <span class="font-medium">Day ${enrollment.day || 1} of ${course.curriculum.length} (${progress}%)</span>
                                    <div class="flex items-center space-x-2">
                                        ${certificateButton}
                                        ${enrollmentActionButton}
                                    </div>
                                </div>
                            </div>
                        `;
          }
        });
      }
    }

    function closeAdminUserDetails() {
      document.getElementById('admin-user-details-modal').style.display = 'none';
      document.getElementById('admin-user-details-modal').removeAttribute('data-user-id');
    }

    // **********************************************
    // ******* END UPDATED: ADMIN MODAL FUNCTIONS *******
    // **********************************************


    // Global initialization call
    initializeUI();
  </script>


  <script>
    // Add helper to show/hide loader
    function showGlobalLoader() {
      const l = document.getElementById('global-loader');
      if (l) l.style.display = 'flex';
    }
    function hideGlobalLoader() {
      const l = document.getElementById('global-loader');
      if (l) l.style.display = 'none';
    }

    // Wrap existing handleLogin and handleRegister if present
    function wrapAuthFunction(name) {
      try {
        const orig = window[name];
        if (typeof orig === 'function') {
          window['__orig__' + name] = orig;
          window[name] = async function(e) {
            try {
              showGlobalLoader();
              const p = orig.call(this, e);
              // if returns a promise, await it
              if (p && typeof p.then === 'function') await p;
            } catch (err) {
              console.error(err);
              throw err;
            } finally {
              // hide loader after small delay to allow UX
              setTimeout(hideGlobalLoader, 600);
            }
          };
        }
      } catch (err) {
        console.warn('Could not wrap', name, err);
      }
    }

    // Attempt to wrap after load
    window.addEventListener('load', function() {
      wrapAuthFunction('handleLogin');
      wrapAuthFunction('handleRegister');
      wrapAuthFunction('handleAdminLogin');
    });

    // Mobile menu open/close
    function openMobileMenu() {
      document.getElementById('mobile-slide-menu').classList.remove('translate-x-full');
      document.getElementById('mobile-slide-menu').classList.add('translate-x-0');
      document.body.style.overflow = 'hidden';
    }
    function closeMobileMenu() {
      document.getElementById('mobile-slide-menu').classList.remove('translate-x-0');
      document.getElementById('mobile-slide-menu').classList.add('translate-x-full');
      document.body.style.overflow = '';
    }

    document.addEventListener('click', function(e) {
      if (e.target && e.target.id === 'mobile-menu-btn') openMobileMenu();
      if (e.target && e.target.id === 'mobile-close-btn') closeMobileMenu();
      // close when clicking backdrop inside menu area (but not when interacting inside)
    });

    // Helper to show Contact section (used by mobile menu)
    function showContact() {
      // scroll to contact section or open it
      const el = document.getElementById('contact-section');
      if (el) {
        el.scrollIntoView({behavior:'smooth'});
      } else {
        alert('Contact section not found.');
      }
    }

    // Slider: populate with 10 sample slides if none exist
    (function initSlider(){
      const track = document.getElementById('slider-track');
      if (!track) return;
      // create 10 slides
      for (let i=1;i<=10;i++) {
        const slide = document.createElement('div');
        slide.className = 'min-w-full flex items-center gap-6 p-8';
        slide.innerHTML = `
          <div class="w-1/2 pr-6">
            <h3 class="text-2xl font-bold mb-3">Student Achievement #${i}</h3>
            <p class="text-gray-600 mb-4">Completed the <strong>Full Stack Web Dev</strong> course with excellence. Scored top 5% in assessments, completed project: Responsive E-commerce site.</p>
            <ul class="text-sm text-gray-700 space-y-1">
              <li>Certificate ID: C-${1000+i}</li>
              <li>Grade: Distinction</li>
              <li>Completion Date: ${new Date().toLocaleDateString()}</li>
            </ul>
          </div>
          <div class="w-1/2 flex justify-center">
            <div class="w-48 h-48 rounded-xl bg-gradient-to-tr from-indigo-500 to-purple-500 flex items-center justify-center text-white text-3xl font-extrabold">
              S${i}
            </div>
          </div>
        `;
        track.appendChild(slide);
      }

      // slider controls
      let index = 0;
      const slides = track.children;
      const total = slides.length;
      function showIndex(i) {
        index = (i + total) % total;
        const offset = -index * 100;
        track.style.transform = 'translateX(' + offset + '%)';
      }
      document.getElementById('slide-next').addEventListener('click', () => showIndex(index+1));
      document.getElementById('slide-prev').addEventListener('click', () => showIndex(index-1));
      // autoplay
      setInterval(()=> showIndex(index+1), 5500);
    })();

    // Certificate enhancement: if a downloadCertificate function exists, wrap it to ensure template includes duration & signature
    (function enhanceCertificate() {
      const orig = window.downloadCertificate;
      window.__orig__downloadCertificate = orig;
      window.downloadCertificate = function() {
        try {
          const certEl = document.getElementById('certificate-content');
          if (certEl) {
            // build a prettier certificate template
            const userName = (document.getElementById('dashboard-user-name') && document.getElementById('dashboard-user-name').textContent) || 'Student Name';
            const courseTitle = (document.querySelector('#certificate-content [data-course-title]') && document.querySelector('#certificate-content [data-course-title]').getAttribute('data-course-title')) || (document.querySelector('.course-title') && document.querySelector('.course-title').textContent) || 'Full Stack Web Development';
            const duration = '10 days'; // default; if you store duration elsewhere, could pick up dynamically
            const issuedDate = new Date().toLocaleDateString();

            certEl.innerHTML = `
              <div class="certificate-bg p-10 text-center text-white rounded-2xl" style="font-family: Roboto, sans-serif;">
                <div style="border:6px solid rgba(255,255,255,0.12); padding:26px; border-radius:18px;">
                  <h2 style="font-size:28px; font-weight:700; letter-spacing:2px;">Certificate of Completion</h2>
                  <p style="margin-top:12px; color:rgba(255,255,255,0.95)">This certifies that</p>
                  <h1 style="font-size:34px; margin-top:8px; font-weight:800;">${userName}</h1>
                  <p style="margin-top:8px;">has successfully completed the</p>
                  <h3 style="font-size:20px; margin-top:6px; font-weight:700;">${courseTitle}</h3>
                  <p style="margin-top:10px; color:rgba(255,255,255,0.95)">Course Duration: <strong>${duration}</strong></p>
                  <p style="margin-top:6px; color:rgba(255,255,255,0.9)">Issued on: ${issuedDate}</p>

                  <div style="display:flex; justify-content:space-between; align-items:center; margin-top:26px;">
                    <div style="text-align:left;">
                      <div style="font-size:12px; color:rgba(255,255,255,0.9)">Course Authority</div>
                      <div style="margin-top:12px; font-family: 'Reenie Beanie', cursive; font-size:28px;">K Purushotham</div>
                      <div style="font-size:12px; color:rgba(255,255,255,0.85)">Founder, EduPro Academy</div>
                    </div>
                    <div style="text-align:right;">
                      <div style="background:rgba(255,255,255,0.12); padding:10px 14px; border-radius:8px; display:inline-block;">Signature</div>
                    </div>
                  </div>
                </div>
              </div>
            `;
          }
        } catch (err) {
          console.warn('Certificate enhancement failed', err);
        }
        // call original download function if exists (so behavior preserved)
        if (typeof window.__orig__downloadCertificate === 'function') {
          try { window.__orig__downloadCertificate(); } catch(e){console.warn(e);}
        }
      };
    })();
  </script>


<!-- PREMIUM FEATURES SCRIPT -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
<script>
(function(){
  // Theme toggle: add floating toggle
  const themeToggleBtn = document.createElement('button');
  themeToggleBtn.id = 'theme-toggle';
  themeToggleBtn.title = 'Toggle Dark / Light';
  themeToggleBtn.style = "position:fixed; right:20px; bottom:20px; z-index:1300; padding:10px 12px; border-radius:999px; background:#111827; color:white; border:none; box-shadow:0 6px 18px rgba(2,6,23,0.25);";
  themeToggleBtn.innerText = '🌙';
  document.body.appendChild(themeToggleBtn);

  function setTheme(t){
    document.documentElement.setAttribute('data-theme', t);
    localStorage.setItem('edupro-theme', t);
    themeToggleBtn.innerText = (t==='dark') ? '☀️' : '🌙';
  }
  const saved = localStorage.getItem('edupro-theme') || (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
  setTheme(saved);

  themeToggleBtn.addEventListener('click', () => {
    const cur = document.documentElement.getAttribute('data-theme') || 'light';
    setTheme(cur==='dark' ? 'light' : 'dark');
  });

  // Apply glass-card class to prominent dashboard cards (non-destructive)
  function applyGlassToDashboard(){
    document.querySelectorAll('#dashboard-screen .bg-gradient-to-r, #admin-dashboard-panel .bg-white, .card-animation').forEach(el=>{
      el.classList.add('glass-card');
    });
  }
  applyGlassToDashboard();
  // Re-apply on DOM changes
  new MutationObserver(applyGlassToDashboard).observe(document.body, {childList:true, subtree:true});

  // Animated course tile enhancements and tag badges
  function enhanceCourseTiles(){
    document.querySelectorAll('#courses-container .bg-white, #popular-courses-preview .card-hover').forEach((el, idx)=>{
      el.classList.add('course-tile');
      // add tag badge if missing
      if(!el.querySelector('.tag-badge')){
        const tag = document.createElement('div');
        tag.className = 'tag-badge';
        tag.style.position='absolute';
        tag.style.top='12px';
        tag.style.right='12px';
        tag.textContent = (idx%3===0)?'Trending':(idx%5===0)?'New':'Popular';
        el.style.position='relative';
        el.appendChild(tag);
      }
    });
  }
  enhanceCourseTiles();
  new MutationObserver(enhanceCourseTiles).observe(document.body, {childList:true, subtree:true});

  // Dynamic gradient header - add class to hero section if present
  document.querySelectorAll('section.hero-gradient').forEach(s => s.classList.add('dynamic-gradient'));

  // Shimmer placeholders for course loading
  function showShimmerPlaceholders(containerId, count=6){
    const container = document.getElementById(containerId);
    if(!container) return;
    container.innerHTML = '';
    for(let i=0;i<count;i++){
      const box = document.createElement('div');
      box.className = 'shimmer p-6 rounded-xl';
      box.style.minHeight='120px';
      container.appendChild(box);
    }
  }
  // Example: show shimmers while loading courses (fade out after 800ms)
  if(document.getElementById('courses-container')){
    showShimmerPlaceholders('courses-container', 6);
    setTimeout(()=>{ // allow existing course-render logic to run then enhance
      // keep existing content; this is just a UX placeholder
      // remove shimmers only if courses rendered
      const cont = document.getElementById('courses-container');
      if(cont && cont.children.length && !cont.children[0].classList.contains('shimmer')){
        // do nothing
      } else {
        // restore (will be replaced when courses render)
        cont.innerHTML = '';
      }
    }, 900);
  }

  // Resume popup when opening a course-learning view
  function showResumePrompt(courseId, day){
    // create modal
    const modal = document.createElement('div');
    modal.className='resume-modal';
    modal.innerHTML = '<div class="modal-inner glass-card p-6"><h3 class="text-lg font-bold mb-2">Resume course?</h3><p class="mb-4">Continue from where you left off (Day '+day+')?</p><div style="display:flex;gap:8px;justify-content:flex-end;"><button id="resume-no" class="px-4 py-2 rounded-lg">Start Over</button><button id="resume-yes" class="px-4 py-2 rounded-lg bg-indigo-600 text-white">Continue</button></div></div>';
    document.body.appendChild(modal);
    modal.querySelector('#resume-yes').addEventListener('click', ()=>{
      // store flag and close
      localStorage.setItem('resume-choice-'+courseId, 'yes');
      modal.remove();
      // open learning view (if original function exists, call it)
      if(typeof window.showCourseLearning === 'function'){
        try{ window.showCourseLearning(courseId); }catch(e){}
      }
    });
    modal.querySelector('#resume-no').addEventListener('click', ()=>{
      localStorage.setItem('resume-choice-'+courseId, 'no');
      modal.remove();
      if(typeof window.showCourseLearning === 'function'){
        try{ window.showCourseLearning(courseId); }catch(e){}
      }
    });
  }

  // Wrap original showCourseLearning (if present) to show prompt when progress exists
  const origShowCourseLearning = window.showCourseLearning;
  window.showCourseLearning = function(courseId){
    try{
      const prog = localStorage.getItem('progress-'+courseId) || 0;
      if(Number(prog) > 0){
        showResumePrompt(courseId, Number(prog));
        return;
      }
    }catch(e){}
    if(typeof origShowCourseLearning === 'function') return origShowCourseLearning.apply(this, arguments);
  };

  // Floating "Mark Complete" button that triggers confetti and gamification XP
  const markBtn = document.createElement('button');
  markBtn.id = 'mark-complete-btn';
  markBtn.innerText = 'Mark Module Complete 🎉';
  document.body.appendChild(markBtn);
  markBtn.addEventListener('click', ()=>{
    // increment XP
    const user = localStorage.getItem('edupro-user') || 'guest';
    const xpKey = 'xp-'+user;
    const cur = Number(localStorage.getItem(xpKey) || 0) + 50;
    localStorage.setItem(xpKey, cur);
    // small confetti burst
    confetti({
      particleCount: 120,
      spread: 70,
      origin: { y: 0.6 }
    });
    // notify
    alert('Module marked complete — +50 XP! Total XP: ' + cur);
    // update leaderboards UI if present
    updateLeaderboardDisplay();
  });

  // Show mark complete button when viewing course-learning
  function toggleMarkButton(){
    const visible = !!document.querySelector('#course-learning:not(.hidden), #course-learning .bg-white');
    if(visible) markBtn.style.display='block'; else markBtn.style.display='none';
  }
  setInterval(toggleMarkButton, 800);

  // Smart search bar (fuzzy)
  function fuzzyMatch(q, text){
    q = q.toLowerCase(); text = text.toLowerCase();
    let qi=0;
    for(let i=0;i<text.length && qi<q.length;i++){
      if(text[i]===q[qi]) qi++;
    }
    return qi===q.length;
  }
  // insert search bar above courses if not present
  if(document.getElementById('courses-container')){
    const wrapper = document.createElement('div');
    wrapper.className='flex justify-center mb-6';
    wrapper.innerHTML = '<input id="premium-search" placeholder="Search courses (fuzzy) — try typing partial words..." />';
    const parent = document.getElementById('course-list');
    if(parent) parent.insertBefore(wrapper, parent.firstChild);
    const input = document.getElementById('premium-search');
    input.addEventListener('input', ()=>{
      const q = input.value.trim();
      const items = document.querySelectorAll('#courses-container > *');
      items.forEach(item=>{
        const text = item.innerText || item.textContent || '';
        item.style.display = (q.length===0) ? '' : (fuzzyMatch(q,text) ? '' : 'none');
      });
    });
  }

  // Simple gamification display: XP and badge indicator on profile and dashboard
  function updateXPDisplays(){
    const user = localStorage.getItem('edupro-user') || 'guest';
    const xp = Number(localStorage.getItem('xp-'+user) || 0);
    // inject into dashboard if element present
    document.querySelectorAll('#dashboard-user-name, #user-name-nav').forEach(el=>{
      if(el) el.innerText = (el.id==='user-name-nav') ? (el.innerText || 'You') : (el.innerText || 'You');
    });
    // create XP badge area
    let xpEl = document.getElementById('xp-badge-global');
    if(!xpEl){
      xpEl = document.createElement('div');
      xpEl.id='xp-badge-global';
      xpEl.style.position='fixed';
      xpEl.style.left='18px';
      xpEl.style.bottom='20px';
      xpEl.style.zIndex='1300';
      xpEl.className='glass-card p-2 px-3';
      document.body.appendChild(xpEl);
    }
    const level = xp>=1000 ? 'Gold' : xp>=500 ? 'Silver' : 'Bronze';
    xpEl.innerHTML = '<strong>XP:</strong> ' + xp + ' • <em>' + level + '</em>';
  }
  updateXPDisplays();
  setInterval(updateXPDisplays, 2000);

  // Leaderboard (sample) -- will try to read users from admin table else use sample
  const sampleLeaderboard = [
    {name:'Priya', xp:1240},
    {name:'Amit', xp:980},
    {name:'Sara', xp:840},
    {name:'Rohit', xp:620},
    {name:'You', xp: Number(localStorage.getItem('xp-'+(localStorage.getItem('edupro-user')||'guest'))||0)}
  ];
  function updateLeaderboardDisplay(){
    let container = document.getElementById('leaderboard-block');
    if(!container){
      container = document.createElement('div');
      container.id='leaderboard-block';
      container.className='leaderboard glass-card p-4';
      container.innerHTML = '<h4 class="font-bold mb-2">Leaderboard</h4><div id="leaderboard-items"></div>';
      const place = document.querySelector('#dashboard-screen') || document.body;
      place.appendChild(container);
    }
    const list = document.getElementById('leaderboard-items');
    const curUserXP = Number(localStorage.getItem('xp-'+(localStorage.getItem('edupro-user')||'guest'))||0);
    sampleLeaderboard[4].xp = curUserXP;
    const sorted = sampleLeaderboard.sort((a,b)=>b.xp-a.xp);
    list.innerHTML = '';
    sorted.forEach((it, idx)=>{
      const el = document.createElement('div');
      el.className='item flex items-center justify-between';
      el.innerHTML = '<div style="display:flex;gap:12px;align-items:center"><div class="avatar">'+(it.name[0]||'?')+'</div><div><div style="font-weight:700">'+it.name+'</div><div style="font-size:13px;opacity:0.8">'+it.xp+'</div></div></div><div style="font-weight:800">'+(idx+1)+'</div>';
      list.appendChild(el);
    });
  }
  updateLeaderboardDisplay();

  // CSV export for admin: generate CSV from admin table rows if present
  function exportAdminCSV(){
    const rows = document.querySelectorAll('#admin-table-body tr');
    if(!rows.length){
      alert('No admin rows detected to export.');
      return;
    }
    const data = [];
    rows.forEach(r=>{
      const cols = Array.from(r.querySelectorAll('td')).map(td=>td.innerText.replace(/\n/g,' '));
      data.push(cols.join(','));
    });
    const csv = data.join('\n');
    const blob = new Blob([csv], {type:'text/csv'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = 'admin_export.csv'; a.click();
    URL.revokeObjectURL(url);
  }
  // add export button to admin panel if present
  function addCSVButton(){
    const adminPanel = document.querySelector('#admin-dashboard-panel .max-w-7xl, #admin-dashboard-panel');
    if(adminPanel && !document.getElementById('export-csv-btn')){
      const btn = document.createElement('button');
      btn.id='export-csv-btn';
      btn.className='bg-indigo-600 text-white py-2 px-3 rounded-lg';
      btn.style.marginLeft='12px';
      btn.innerText='Export Enrollments CSV';
      btn.addEventListener('click', exportAdminCSV);
      adminPanel.prepend(btn);
    }
  }
  addCSVButton();
  new MutationObserver(addCSVButton).observe(document.body, {childList:true, subtree:true});

  // PWA: manifest link and simple service worker registration (basic offline caching)
  try{
    if(!document.querySelector('link[rel="manifest"]')){
      const manifest = {
        "name":"EduPro Academy",
        "short_name":"EduPro",
        "start_url":".",
        "display":"standalone",
        "background_color":"#ffffff",
        "theme_color":"#667eea",
        "icons":[{"src":"favicon.png","sizes":"192x192","type":"image/png"}]
      };
      const blob = new Blob([JSON.stringify(manifest)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const link = document.createElement('link');
      link.rel='manifest'; link.href = url;
      document.head.appendChild(link);
    }
    if('serviceWorker' in navigator){
      navigator.serviceWorker.register('/edupro-sw.js').catch(()=>{ /* ignore */ });
    }
  }catch(e){}

  // Create a very small service worker file in the same directory for caching basic assets
  // (This will only work when served from a server; file:// won't register workers.)
  function tryWriteSW(){
    const swCode = "self.addEventListener('install', e=>{self.skipWaiting();});self.addEventListener('fetch', ()=>{});";
    try{
      // create a blob URL and register (best-effort)
      const blob = new Blob([swCode], {type:'application/javascript'});
      const swUrl = URL.createObjectURL(blob);
      if('serviceWorker' in navigator){
        navigator.serviceWorker.register(swUrl).catch(()=>{});
      }
    }catch(e){}
  }
  tryWriteSW();

  // Recent activity timeline (reads localStorage events)
  function pushActivity(text){
    const now = new Date().toLocaleString();
    const arr = JSON.parse(localStorage.getItem('activity-timeline')||'[]');
    arr.unshift({t:now, text});
    localStorage.setItem('activity-timeline', JSON.stringify(arr.slice(0,50)));
    renderActivityTimeline();
  }
  function renderActivityTimeline(){
    let container = document.getElementById('activity-timeline');
    if(!container){
      container = document.createElement('div');
      container.id='activity-timeline';
      container.className='glass-card p-4';
      container.innerHTML = '<h4 class="font-bold mb-2">Recent Activity</h4><div id="activity-items"></div>';
      const place = document.querySelector('#dashboard-screen') || document.body;
      place.appendChild(container);
    }
    const items = document.getElementById('activity-items');
    const arr = JSON.parse(localStorage.getItem('activity-timeline')||'[]');
    items.innerHTML = '';
    arr.forEach(a=>{
      const el = document.createElement('div');
      el.style.padding='8px 0'; el.style.borderBottom='1px solid rgba(15,23,42,0.04)';
      el.innerHTML = '<div style="font-weight:700">'+a.text+'</div><div style="font-size:12px;color:var(--text);opacity:0.7">'+a.t+'</div>';
      items.appendChild(el);
    });
  }
  renderActivityTimeline();

  // Hook some actions to pushActivity examples
  const origPauseAllVideos = window.pauseAllVideos;
  window.pauseAllVideos = function(){ try{ pushActivity('Paused media due to navigation'); }catch(e){}; if(typeof origPauseAllVideos==='function') origPauseAllVideos(); };

  // Offer course recommendations (very simple: suggest courses of same category from courses array if present)
  function showRecommendations(courseId){
    const contId = 'recommendations-block';
    let cont = document.getElementById(contId);
    if(!cont){
      cont = document.createElement('div'); cont.id=contId; cont.className='glass-card p-4';
      cont.innerHTML = '<h4 class="font-bold mb-2">Recommended for you</h4><div id="rec-items" class="grid grid-cols-1 gap-2"></div>';
      const place = document.querySelector('#course-detail') || document.querySelector('#course-learning') || document.body;
      place.appendChild(cont);
    }
    const recItems = document.getElementById('rec-items');
    recItems.innerHTML = '';
    try{
      if(window.courses && courseId){
        const current = window.courses.find(c=>c.id===courseId);
        const same = window.courses.filter(c=>c.category===current.category && c.id!==courseId).slice(0,4);
        same.forEach(s=>{
          const el = document.createElement('div');
          el.className='p-2 rounded-lg flex items-center justify-between';
          el.innerHTML = '<div><div style="font-weight:700">'+s.title+'</div><div style="font-size:13px;opacity:0.8">'+s.duration+' • '+s.level+'</div></div><button onclick="showCourseDetail(\''+s.id+'\')" class="px-3 py-1 rounded-lg bg-indigo-600 text-white">View</button>';
          recItems.appendChild(el);
        });
      }
    }catch(e){}
  }
  // expose for use
  window.showRecommendations = showRecommendations;

  // Simple draggable widgets (drag to reorder within dashboard)
  function enableWidgetDrag(){
    const container = document.querySelector('#dashboard-screen .grid') || document.querySelector('#dashboard-screen');
    if(!container) return;
    container.querySelectorAll('.glass-card').forEach((w, idx)=>{
      w.setAttribute('draggable', 'true');
      w.classList.add('widget');
      w.addEventListener('dragstart', e=>{
        e.dataTransfer.setData('text/widget-index', idx);
        w.classList.add('opacity-50');
      });
      w.addEventListener('dragend', e=> w.classList.remove('opacity-50'));
      w.addEventListener('dragover', e=> e.preventDefault());
      w.addEventListener('drop', e=>{
        e.preventDefault();
        const from = Number(e.dataTransfer.getData('text/widget-index'));
        const to = Array.from(w.parentElement.children).indexOf(w);
        if(from===to) return;
        const parent = w.parentElement;
        const children = Array.from(parent.children);
        const node = children[from];
        parent.removeChild(node);
        parent.insertBefore(node, parent.children[to]);
      });
    });
  }
  setTimeout(enableWidgetDrag, 1200);

  // CSV for user's certificates: export certificates content if displayed
  function exportCertificatesCSV(){
    const certs = document.querySelectorAll('#certificates-container .certificate');
    if(!certs.length){ alert('No certificates found'); return; }
    const rows = [['Name','Course','Date']];
    certs.forEach(c=>{
      const name = c.querySelector('.cert-name') ? c.querySelector('.cert-name').innerText : 'Unknown';
      const course = c.querySelector('.cert-course') ? c.querySelector('.cert-course').innerText : 'Unknown';
      const date = c.querySelector('.cert-date') ? c.querySelector('.cert-date').innerText : new Date().toLocaleDateString();
      rows.push([name,course,date]);
    });
    const csv = rows.map(r=>r.join(',')).join('\n');
    const blob = new Blob([csv], {type:'text/csv'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href=url; a.download='certificates.csv'; a.click();
    URL.revokeObjectURL(url);
  }
  // add export certificates button
  function addExportCertBtn(){
    const cont = document.getElementById('certificates-screen');
    if(cont && !document.getElementById('export-certs-btn')){
      const btn = document.createElement('button');
      btn.id='export-certs-btn';
      btn.className='bg-green-600 text-white py-2 px-3 rounded-lg';
      btn.style.marginBottom='12px';
      btn.innerText='Export Certificates CSV';
      btn.addEventListener('click', exportCertificatesCSV);
      cont.prepend(btn);
    }
  }
  addExportCertBtn();
  new MutationObserver(addExportCertBtn).observe(document.body, {childList:true, subtree:true});

  // Small UI tweak: add "New" badge to popular courses section header
  const popularHeader = document.querySelector('#popular-courses-preview');
  if(popularHeader && !document.getElementById('popular-badge')){
    const badge = document.createElement('div');
    badge.id='popular-badge';
    badge.className='tag-badge';
    badge.style.margin='12px';
    badge.textContent='New Collection';
    popularHeader.parentElement.insertBefore(badge, popularHeader);
  }

  // expose some utility functions for debugging
  window.eduproPremium = {
    pushActivity, exportAdminCSV, exportCertificatesCSV, updateLeaderboardDisplay, showRecommendations
  };

  // notify user UI features loaded
  console.info('EduPro Premium UI bundle loaded — Glass, Dark Mode, Search, Shimmer, Gamification, PWA hooks.');
})();
</script>


<script>
(function(){
  console.info('EduPro Final Feature Rework init');

  // --- 1) Remove gamification interactive elements (mark-complete button, xp badge) ---
  const markBtn = document.getElementById('mark-complete-btn');
  if(markBtn) markBtn.remove();
  const xpBadge = document.getElementById('xp-badge-global');
  if(xpBadge) xpBadge.remove();

  // Stop any intervals that update XP displays if present (best-effort)
  try{ if(window._edupro_xp_interval) { clearInterval(window._edupro_xp_interval); } }catch(e){}

  // --- 2) Progress badges as progress bars for levels (Bronze/Silver/Gold) ---
  function scoreToLevel(score){
    if(score >= 1000) return {level:'Gold', pct: Math.min(100, Math.round((score/1500)*100))};
    if(score >= 500) return {level:'Silver', pct: Math.min(100, Math.round((score/1000)*100))};
    return {level:'Bronze', pct: Math.min(100, Math.round((score/500)*100))};
  }

  function renderUserProgressBadge(container, score){
    const info = scoreToLevel(Number(score||0));
    // avoid duplicate
    if(container.querySelector('.level-badge-wrap')) return;
    const wrap = document.createElement('div');
    wrap.className = 'level-badge-wrap p-2 rounded-lg glass-card';
    wrap.style.marginTop = '8px';
    wrap.innerHTML = '<div style="font-weight:700;margin-bottom:6px">Level: '+info.level+' <span style="font-weight:600;color:var(--text);opacity:0.85">('+score+' pts)</span></div><div style="height:10px;background:rgba(0,0,0,0.08);border-radius:999px;overflow:hidden"><div style="height:10px;width:'+info.pct+'%;background:linear-gradient(90deg,#f59e0b,#ef4444)"></div></div>';
    container.appendChild(wrap);
  }

  // Attach progress badge near user profile area if score available
  function attachProgressBadgeGlobal(){
    const profileArea = document.querySelector('#my-account-details-container') || document.querySelector('#dashboard-screen') || document.body;
    if(!profileArea) return;
    // determine score from several sources
    let score = null;
    // 1. window.userScore or window.currentUserScore
    if(typeof window.userScore !== 'undefined') score = window.userScore;
    if(!score && typeof window.currentUserScore !== 'undefined') score = window.currentUserScore;
    // 2. localStorage 'user-score' or 'score-<user>'
    if(!score){
      try{
        const ls = localStorage.getItem('user-score') || localStorage.getItem('score-'+(localStorage.getItem('edupro-user')||'guest'));
        if(ls) score = Number(ls);
      }catch(e){}
    }
    // 3. fallback 0
    score = Number(score||0);
    renderUserProgressBadge(profileArea, score);
  }
  attachProgressBadgeGlobal();

  // --- 3) Dynamic Leaderboard ---
  function gatherScoresFromAdminTable(){
    const rows = document.querySelectorAll('#admin-table-body tr');
    const scores = [];
    if(!rows || rows.length===0) return scores;
    rows.forEach(r=>{
      // attempt to find name and score in cells or data attributes
      const cells = Array.from(r.querySelectorAll('td'));
      let name = cells[0] ? cells[0].innerText.trim() : null;
      let email = cells[1] ? cells[1].innerText.trim() : null;
      // find numeric in row (highest numeric cell)
      let score = null;
      cells.forEach(td=>{
        const num = td.innerText.replace(/[^\d]/g,'');
        if(num && Number(num)>0) score = Number(num);
      });
      // also check data-score attribute
      if(!score && r.dataset && r.dataset.score) score = Number(r.dataset.score);
      if(!name && email) name = email.split('@')[0];
      if(name) scores.push({name: name, score: Number(score||0)});
    });
    return scores;
  }

  function gatherScoresFromWindow(){
    try{
      if(window.userScores && Array.isArray(window.userScores)) return window.userScores.map(u=>({name:u.name||u.id, score: Number(u.score||u.xp||0)}));
      if(window.allUserScores && Array.isArray(window.allUserScores)) return window.allUserScores;
    }catch(e){}
    return [];
  }

  function gatherScoresFromLocalStorage(){
    try{
      const raw = localStorage.getItem('userScores'); // expected JSON array
      if(raw){
        const arr = JSON.parse(raw);
        if(Array.isArray(arr)) return arr.map(u=>({name:u.name||u.id, score: Number(u.score||u.xp||0)}));
      }
    }catch(e){}
    return [];
  }

  function buildDynamicLeaderboard(){
    let scores = [];
    scores = scores.concat(gatherScoresFromWindow());
    const admin = gatherScoresFromAdminTable();
    if(admin && admin.length) scores = scores.concat(admin);
    const ls = gatherScoresFromLocalStorage();
    if(ls && ls.length) scores = scores.concat(ls);

    // dedupe by name, take max score
    const map = {};
    scores.forEach(s=>{
      const key = (s.name||'unknown').toLowerCase();
      if(!map[key] || (s.score||0) > (map[key].score||0)) map[key] = {name: s.name, score: Number(s.score||0)};
    });
    const arr = Object.values(map).sort((a,b)=>b.score - a.score).slice(0,10);
    renderLeaderboard(arr);
    return arr;
  }

  function renderLeaderboard(list){
    let container = document.getElementById('leaderboard-block');
    if(!container){
      container = document.createElement('div');
      container.id='leaderboard-block';
      container.className='leaderboard glass-card p-4';
      container.style.maxWidth='420px';
      container.innerHTML = '<h4 class="font-bold mb-2">Leaderboard</h4><div id="leaderboard-items"></div>';
      const place = document.querySelector('#dashboard-screen') || document.body;
      place.appendChild(container);
    }
    const items = document.getElementById('leaderboard-items');
    items.innerHTML = '';
    if(!list || list.length===0){
      items.innerHTML = '<div style="padding:8px;color:var(--text);opacity:0.75">No leaderboard data available.</div>';
      return;
    }
    list.forEach((it, idx)=>{
      const el = document.createElement('div');
      el.className = 'item flex items-center justify-between p-2';
      el.style.borderBottom = '1px solid rgba(15,23,42,0.04)';
      el.innerHTML = '<div style="display:flex;gap:12px;align-items:center"><div class="avatar">'+(it.name[0]||'?')+'</div><div><div style="font-weight:700">'+it.name+'</div><div style="font-size:13px;opacity:0.8">Score '+it.score+'</div></div></div><div style="font-weight:800">'+(idx+1)+'</div>';
      items.appendChild(el);
    });
  }

  // initial build and observe changes
  buildDynamicLeaderboard();
  // Rebuild if admin table changes
  const adminTable = document.getElementById('admin-table-body');
  if(adminTable){
    new MutationObserver(buildDynamicLeaderboard).observe(adminTable, {childList:true, subtree:true});
  }

  // --- 4) Certificates Gallery (dynamic) ---
  function buildCertificatesGallery(){
    const cont = document.getElementById('certificates-container');
    if(!cont) return;
    // If certificates already present, style them; else try to read stored certs from localStorage or window.certs
    if(cont.children.length === 0){
      let sourced = [];
      try{
        if(window.userCertificates && Array.isArray(window.userCertificates)) sourced = window.userCertificates;
        else {
          const raw = localStorage.getItem('userCertificates');
          if(raw) sourced = JSON.parse(raw);
        }
      }catch(e){}
      if(sourced && sourced.length){
        sourced.forEach(c=>{
          const card = document.createElement('div');
          card.className = 'certificate glass-card p-6 rounded-lg';
          card.innerHTML = '<div class="cert-name" style="font-weight:800">'+(c.name||'Name')+'</div><div class="cert-course" style="opacity:0.85">'+(c.course||'Course')+'</div><div class="cert-date" style="font-size:13px;margin-top:6px">'+(c.date||new Date().toLocaleDateString())+'</div>';
          cont.appendChild(card);
        });
      }
    } else {
      // apply gallery styling
      Array.from(cont.children).forEach(c=>{
        c.classList.add('glass-card');
      });
    }
  }
  buildCertificatesGallery();
  // expose export helper if needed
  window.buildCertificatesGallery = buildCertificatesGallery;

  // --- 5) Fuzzy Search with highlight ---
  function escapeHtml(s){ return s.replace(/[&<>"']/g, function(m){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]; }); }
  function highlightText(node, query){
    if(!query) return;
    const q = query.trim().toLowerCase();
    if(q.length===0) return;
    // Walk text nodes inside node and wrap matches
    const walker = document.createTreeWalker(node, NodeFilter.SHOW_TEXT, null, false);
    const toWrap = [];
    while(walker.nextNode()){
      const txt = walker.currentNode.nodeValue;
      if(!txt) continue;
      const idx = txt.toLowerCase().indexOf(q);
      if(idx !== -1){
        toWrap.push({node: walker.currentNode, idx, len: q.length});
      }
    }
    // wrap from last to first to keep indices valid
    for(let i=toWrap.length-1;i>=0;i--){
      const item = toWrap[i];
      const n = item.node;
      const val = n.nodeValue;
      const before = val.slice(0, item.idx);
      const match = val.slice(item.idx, item.idx + item.len);
      const after = val.slice(item.idx + item.len);
      const span = document.createElement('span');
      span.innerHTML = escapeHtml(before) + '<mark style="background:linear-gradient(90deg,#fde68a,#fca5a5);padding:0 2px;border-radius:3px">'+escapeHtml(match)+'</mark>' + escapeHtml(after);
      n.parentNode.replaceChild(span, n);
    }
  }

  // integrate with existing premium-search input if present
  const premiumSearch = document.getElementById('premium-search');
  if(premiumSearch){
    premiumSearch.addEventListener('input', function(){
      const q = this.value.trim();
      const items = document.querySelectorAll('#courses-container > *');
      items.forEach(item=>{
        // reset highlights: replace <mark> if present by plain text (naive approach: re-render item textContent)
        // To avoid destroying structure, clone and strip marks
        const clone = item.cloneNode(true);
        // remove existing marks
        clone.querySelectorAll('mark').forEach(m=> {
          const txt = document.createTextNode(m.textContent);
          m.parentNode.replaceChild(txt, m);
        });
        // replace item display for highlighting
        if(q.length===0){
          // restore original innerHTML from clone
          item.innerHTML = clone.innerHTML;
          item.style.display = '';
        } else {
          const text = (clone.innerText || clone.textContent || '').toLowerCase();
          if(text.indexOf(q) !== -1 || (function(){ // fuzzy fallback
            let qi=0; for(let i=0;i<text.length && qi<q.length;i++){ if(text[i]===q[qi]) qi++; } return qi===q.length;
          })()){
            // highlight in-place (work on original)
            // remove previous marks
            item.querySelectorAll('mark').forEach(m=> {
              const txt = document.createTextNode(m.textContent);
              m.parentNode.replaceChild(txt, m);
            });
            highlightText(item, q);
            item.style.display = '';
          } else {
            item.style.display = 'none';
          }
        }
      });
    });
  }

  // --- 6) Confetti on certificate download & complete buttons ---
  // Wrap existing downloadCertificate if present
  if(typeof window.downloadCertificate === 'function'){
    const orig = window.downloadCertificate;
    window.downloadCertificate = function(){
      try{ if(window.confetti) window.confetti({particleCount:120, spread:70, origin:{y:0.6}}); }catch(e){}
      try{ return orig.apply(this, arguments); }catch(e){ console.error(e); }
    };
  } else {
    // listen for clicks on any element with class .download-cert-btn to trigger confetti
    document.addEventListener('click', function(e){
      const t = e.target.closest && e.target.closest('.download-cert-btn, .download-certificate, .certificate-download');
      if(t){
        try{ if(window.confetti) window.confetti({particleCount:120, spread:70, origin:{y:0.6}}); }catch(e){}
      }
    });
  }

  // Also trigger confetti for elements with .complete-module-btn class (non-destructive)
  document.addEventListener('click', function(e){
    const btn = e.target.closest && e.target.closest('.complete-module-btn');
    if(btn){
      try{ if(window.confetti) window.confetti({particleCount:90, spread:60, origin:{y:0.6}}); }catch(e){}
      // if they have data-score attribute, add to local score store (but per user request we removed gamification - so we won't increment)
    }
  });

  // --- 7) Recommendations plumbing: attempt to call showRecommendations when entering course detail view ---
  // Wrap showCourseDetail if exists
  if(typeof window.showCourseDetail === 'function'){
    const origDetail = window.showCourseDetail;
    window.showCourseDetail = function(id){
      try{ showRecommendations(id); }catch(e){}
      return origDetail.apply(this, arguments);
    };
  }

  // expose rebuild functions
  window.eduproFinal = {
    buildDynamicLeaderboard, buildCertificatesGallery, attachProgressBadgeGlobal
  };

  console.info('EduPro Final Feature Rework completed.');
})();
</script>

</body>

</html>
